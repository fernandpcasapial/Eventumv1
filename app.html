<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ATLAS - Actividades</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { 
      margin: 0; 
      padding: 0;
      font-family: 'Inter', sans-serif; 
      background: #ffffff;
      min-height: 100vh;
      height: 100vh;
      overflow: hidden;
    }
    html {
      height: 100vh;
      overflow: hidden;
    }
    .font-sf-display { 
      font-family: 'Inter', sans-serif; 
      font-weight: 700; 
    }
    .font-sf-text { 
      font-family: 'Inter', sans-serif; 
    }
    #root {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0;
      overflow: hidden;
    }
    @media (min-width: 1024px) {
      #root {
        padding: 0.5rem;
      }
    }
    .map-container {
      height: 100%;
      flex: 1;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(251, 191, 36, 0.3), 0 10px 10px -5px rgba(251, 191, 36, 0.2);
    }
    .app-container {
      width: 100%;
      height: 100vh;
      max-width: 100%;
      background: white;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    @media (min-width: 640px) {
      .app-container {
        max-width: 640px;
        height: 100vh;
      }
    }
    @media (min-width: 1024px) {
      .app-container {
        max-width: 100%;
        height: 100vh;
        border-radius: 0;
      }
    }
    .card-hover {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card-hover:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 25px 50px -12px rgba(212, 175, 55, 0.5), 0 0 30px rgba(185, 119, 14, 0.3);
    }
    .gradient-gold {
      background: linear-gradient(135deg, #f4d03f 0%, #f39c12 25%, #d68910 50%, #b9770e 75%, #a5690d 100%);
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    .gradient-gold-light {
      background: linear-gradient(135deg, #fef9e7 0%, #fdebd0 25%, #fad7a0 50%, #f8c471 100%);
    }
    .gradient-gold-dark {
      background: linear-gradient(135deg, #b9770e 0%, #a5690d 25%, #935116 50%, #7d6608 100%);
      box-shadow: 0 10px 30px rgba(165, 105, 13, 0.5);
    }
    .text-gold {
      color: #d68910;
    }
    .text-gold-gradient {
      background: linear-gradient(135deg, #f4d03f 0%, #f39c12 25%, #d68910 50%, #b9770e 75%, #a5690d 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 2px 4px rgba(212, 175, 55, 0.3));
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .leaflet-container {
      border-radius: 1rem;
      z-index: 1;
    }
    .custom-marker {
      background: #f59e0b;
      border: 3px solid white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      box-shadow: 0 2px 8px rgba(251, 191, 36, 0.5);
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      25% { transform: translateY(-10px) rotate(2deg); }
      50% { transform: translateY(-15px) rotate(0deg); }
      75% { transform: translateY(-10px) rotate(-2deg); }
    }
    .float-animation {
      animation: float 4s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { 
        box-shadow: 0 0 25px rgba(212, 175, 55, 0.7), 0 0 50px rgba(212, 175, 55, 0.5), 0 0 75px rgba(185, 119, 14, 0.3);
        filter: brightness(1);
      }
      50% { 
        box-shadow: 0 0 35px rgba(212, 175, 55, 0.9), 0 0 70px rgba(212, 175, 55, 0.7), 0 0 100px rgba(185, 119, 14, 0.5);
        filter: brightness(1.1);
      }
    }
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    .shimmer {
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      background-size: 1000px 100%;
      animation: shimmer 3s infinite;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide-in {
      animation: slideIn 0.6s ease-out;
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .scale-in {
      animation: scaleIn 0.5s ease-out;
    }
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .rotate-slow {
      animation: rotate 20s linear infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .bounce-slow {
      animation: bounce 2s ease-in-out infinite;
    }
    @keyframes glow {
      0%, 100% { filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.5)); }
      50% { filter: drop-shadow(0 0 20px rgba(251, 191, 36, 0.8)); }
    }
    .glow-animation {
      animation: glow 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, memo, useRef, useEffect } = React;

    // Iconos SVG
    const Icon = ({ children, className = "", ...props }) => (
      <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24" {...props}>
        {children}
      </svg>
    );

    const Home = (props) => <Icon {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></Icon>;
    const LayoutGrid = (props) => <Icon {...props}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></Icon>;
    const Filter = (props) => <Icon {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></Icon>;
    const MapPin = (props) => <Icon {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></Icon>;
    const Search = (props) => <Icon {...props}><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></Icon>;
    const Heart = (props) => <Icon {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></Icon>;
    const RotateCcw = (props) => <Icon {...props}><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></Icon>;
    const ChevronLeft = (props) => <Icon {...props}><polyline points="15 18 9 12 15 6"></polyline></Icon>;
    const ChevronRight = (props) => <Icon {...props}><polyline points="9 18 15 12 9 6"></polyline></Icon>;
    const Sparkles = (props) => <Icon {...props}><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></Icon>;
    const Users = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></Icon>;
    const Shuffle = (props) => <Icon {...props}><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></Icon>;
    const Compass = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></Icon>;
    const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
    const Coffee = (props) => <Icon {...props}><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></Icon>;
    const Mic = (props) => <Icon {...props}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></Icon>;
    const Palette = (props) => <Icon {...props}><circle cx="13.5" cy="6.5" r=".5"></circle><circle cx="17.5" cy="10.5" r=".5"></circle><circle cx="8.5" cy="7.5" r=".5"></circle><circle cx="6.5" cy="12.5" r=".5"></circle><path d="M12 2C6.5 2 2 6.5 2 12c0 4.2 2.7 7.7 6.4 9c.4.1.9-.1 1-.6l.8-2.9c.1-.4-.1-.9-.5-1.1-1.1-.6-1.8-1.7-1.8-3 0-2 1.6-3.6 3.6-3.6s3.6 1.6 3.6 3.6c0 1.3-.7 2.4-1.8 3-.4.2-.6.7-.5 1.1l.8 2.9c.1.5.6.7 1 .6 3.7-1.3 6.4-4.8 6.4-9 0-5.5-4.5-10-10-10z"></path></Icon>;
    const Gamepad = (props) => <Icon {...props}><line x1="6" y1="12" x2="10" y2="12"></line><line x1="8" y1="10" x2="8" y2="14"></line><line x1="15" y1="13" x2="15.01" y2="13"></line><line x1="18" y1="11" x2="18.01" y2="11"></line><rect x="2" y="6" width="20" height="12" rx="2"></rect></Icon>;
    const History = (props) => <Icon {...props}><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></Icon>;
    const Code = (props) => <Icon {...props}><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></Icon>;
    const Mountain = (props) => <Icon {...props}><path d="M8 3l4 8 5-4 5 11H4L8 3z"></path></Icon>;
    const GraduationCap = (props) => <Icon {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></Icon>;
    const Handshake = (props) => <Icon {...props}><path d="M11 12h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 14"></path><path d="M7 18h1c.5 0 1-.2 1.4-.6l5-5"></path><path d="M14 9l4 4"></path><path d="M15 12h5c.5 0 1-.2 1.4-.6l2-2"></path><path d="M18 6l4 4"></path></Icon>;
    const Dumbbell = (props) => <Icon {...props}><path d="M6.5 6.5h11v11h-11z"></path><path d="M6.5 6.5L2 2"></path><path d="M17.5 6.5L22 2"></path><path d="M17.5 17.5L22 22"></path><path d="M6.5 17.5L2 22"></path></Icon>;
    const Feather = (props) => <Icon {...props}><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="6.5"></line></Icon>;
    const Tent = (props) => <Icon {...props}><path d="M3.5 21l8.5-18 8.5 18H14l-2-4H9l-2 4H3.5z"></path></Icon>;
    const Anchor = (props) => <Icon {...props}><circle cx="12" cy="5" r="3"></circle><line x1="12" y1="8" x2="12" y2="16"></line><path d="M19 12H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2z"></path></Icon>;
    const Globe = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></Icon>;
    const Camera = (props) => <Icon {...props}><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></Icon>;
    const Music = (props) => <Icon {...props}><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></Icon>;
    const Zap = (props) => <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></Icon>;
    const User = (props) => <Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></Icon>;
    const Calendar = (props) => <Icon {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></Icon>;
    const CreditCard = (props) => <Icon {...props}><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></Icon>;
    const Star = (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>;
    const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>;
    const Edit = (props) => <Icon {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></Icon>;
    const Trash = (props) => <Icon {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></Icon>;
    const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"></polyline></Icon>;
    const Building = (props) => <Icon {...props}><path d="M3 21h18"></path><path d="M5 21V7l8-4v18"></path><path d="M19 21V11l-6-4"></path><line x1="9" y1="9" x2="9" y2="9"></line><line x1="9" y1="12" x2="9" y2="12"></line><line x1="9" y1="15" x2="9" y2="15"></line><line x1="9" y1="18" x2="9" y2="18"></line></Icon>;
    const BarChart = (props) => <Icon {...props}><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></Icon>;
    const TrendingUp = (props) => <Icon {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></Icon>;
    const Settings = (props) => <Icon {...props}><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path></Icon>;
    const Bell = (props) => <Icon {...props}><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></Icon>;
    const Clock = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
    const ShoppingBag = (props) => <Icon {...props}><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></Icon>;
    const Share2 = (props) => <Icon {...props}><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></Icon>;
    const Bookmark = (props) => <Icon {...props}><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></Icon>;
    const MapPin2 = (props) => <Icon {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></Icon>;
    const Users2 = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></Icon>;
    const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></Icon>;
    const ExternalLink = (props) => <Icon {...props}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></Icon>;
    const X = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>;
    const Film = (props) => <Icon {...props}><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></Icon>;
    const Utensils = (props) => <Icon {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3z"></path><path d="M21 15v7"></path></Icon>;
    const Car = (props) => <Icon {...props}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.7 5c-.3-.8-1-1.3-1.9-1.3h-3.8c-.9 0-1.6.5-1.9 1.3l-1.5 4.7c-.2.1-.4.2-.6.2H5c-1.1 0-2 .9-2 2v3c0 .6.4 1 1 1h2"></path><circle cx="7" cy="17" r="2"></circle><circle cx="17" cy="17" r="2"></circle></Icon>;
    const Plane = (props) => <Icon {...props}><path d="M17.8 19.2L16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"></path></Icon>;
    const ShoppingCart = (props) => <Icon {...props}><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></Icon>;
    const Gift = (props) => <Icon {...props}><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></Icon>;
    const Sun = (props) => <Icon {...props}><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></Icon>;
    const Moon = (props) => <Icon {...props}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></Icon>;
    const Leaf = (props) => <Icon {...props}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></Icon>;
    const Droplet = (props) => <Icon {...props}><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></Icon>;
    const Snowflake = (props) => <Icon {...props}><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line><line x1="6.34" y1="6.34" x2="17.66" y2="17.66"></line><line x1="6.34" y1="17.66" x2="17.66" y2="6.34"></line><line x1="19.07" y1="4.93" x2="4.93" y2="19.07"></line><line x1="19.07" y1="19.07" x2="4.93" y2="4.93"></line></Icon>;
    const Wind = (props) => <Icon {...props}><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"></path></Icon>;
    const Bike = (props) => <Icon {...props}><circle cx="5.5" cy="17.5" r="3.5"></circle><circle cx="18.5" cy="17.5" r="3.5"></circle><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path><path d="M12 17.5V14l-3-3 4-3 2 3h3"></path></Icon>;
    const Trophy = (props) => <Icon {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2z"></path></Icon>;
    const Target = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></Icon>;
    const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></Icon>;
    const Award = (props) => <Icon {...props}><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></Icon>;
    const Briefcase = (props) => <Icon {...props}><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></Icon>;
    const HeartHandshake = (props) => <Icon {...props}><path d="M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16"></path><path d="M7 20h1c.5 0 1-.2 1.4-.6l5-5"></path><path d="M14 11l4 4"></path><path d="M15 14h5c.5 0 1-.2 1.4-.6l2-2"></path><path d="M18 8l4 4"></path><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></Icon>;
    const Image = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></Icon>;
    const Video = (props) => <Icon {...props}><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></Icon>;
    const Radio = (props) => <Icon {...props}><circle cx="5" cy="12" r="3"></circle><path d="M12 1a11 11 0 0 0-3 21"></path><path d="M12 1a11 11 0 0 1 3 21"></path><path d="M12 1v20"></path></Icon>;
    const Headphones = (props) => <Icon {...props}><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></Icon>;
    const RadioIcon = (props) => <Icon {...props}><path d="M4.9 4.9L19.1 19.1"></path><path d="M14 10a3 3 0 0 1 3 3"></path><path d="M17 17a7 7 0 0 0-7-7"></path><circle cx="12" cy="12" r="1"></circle><path d="M3 3l18 18"></path></Icon>;

    // 40 CATEGOR√çAS (20 originales + 20 nuevas)
const categories = [
  { id: 'anime', nombre: 'Anime', icon: BookOpen, emoji: 'üç•' },
  { id: 'cine', nombre: 'Cine', icon: Camera, emoji: 'üé¨' },
  { id: 'deportes', nombre: 'Deportes', icon: Dumbbell, emoji: '‚öΩ' },
  { id: 'turismo', nombre: 'Turismo', icon: Globe, emoji: 'üó∫Ô∏è' },
  { id: 'diversion', nombre: 'Diversi√≥n', icon: Zap, emoji: 'üéâ' },
  { id: 'comida', nombre: 'Comida', icon: Coffee, emoji: 'üçï' },
  { id: 'conciertos', nombre: 'Conciertos', icon: Mic, emoji: 'üé§' },
  { id: 'arte', nombre: 'Arte', icon: Palette, emoji: 'üé®' },
  { id: 'gaming', nombre: 'Gaming', icon: Gamepad, emoji: 'üéÆ' },
  { id: 'cultura', nombre: 'Cultura', icon: History, emoji: 'üèõÔ∏è' },
  { id: 'musica', nombre: 'M√∫sica', icon: Music, emoji: 'üéß' },
  { id: 'tech', nombre: 'Tecnolog√≠a', icon: Code, emoji: 'üíª' },
      { id: 'aire_libre', nombre: 'Aire Libre', icon: Mountain, emoji: 'üå≥' },
  { id: 'educacion', nombre: 'Educaci√≥n', icon: GraduationCap, emoji: 'üìö' },
  { id: 'voluntariado', nombre: 'Voluntariado', icon: Handshake, emoji: 'ü§ù' },
  { id: 'bienestar', nombre: 'Bienestar', icon: Feather, emoji: 'üßò' },
  { id: 'aventura', nombre: 'Aventura', icon: Tent, emoji: '‚õ∞Ô∏è' },
  { id: 'viajes', nombre: 'Viajes', icon: Anchor, emoji: '‚úàÔ∏è' },
  { id: 'fotografia', nombre: 'Fotograf√≠a', icon: Camera, emoji: 'üì∏' },
  { id: 'lectura', nombre: 'Lectura', icon: BookOpen, emoji: 'üìñ' },
      // 20 nuevas categor√≠as
      { id: 'teatro', nombre: 'Teatro', icon: Film, emoji: 'üé≠' },
      { id: 'restaurantes', nombre: 'Restaurantes', icon: Utensils, emoji: 'üçΩÔ∏è' },
      { id: 'automovilismo', nombre: 'Automovilismo', icon: Car, emoji: 'üèéÔ∏è' },
      { id: 'aviation', nombre: 'Aviaci√≥n', icon: Plane, emoji: '‚úàÔ∏è' },
      { id: 'compras', nombre: 'Compras', icon: ShoppingBag, emoji: 'üõçÔ∏è' },
      { id: 'regalos', nombre: 'Regalos', icon: Gift, emoji: 'üéÅ' },
      { id: 'playa', nombre: 'Playa', icon: Sun, emoji: 'üèñÔ∏è' },
      { id: 'noche', nombre: 'Noche', icon: Moon, emoji: 'üåô' },
      { id: 'naturaleza', nombre: 'Naturaleza', icon: Leaf, emoji: 'üåø' },
      { id: 'agua', nombre: 'Acu√°ticos', icon: Droplet, emoji: 'üíß' },
      { id: 'invierno', nombre: 'Invierno', icon: Snowflake, emoji: '‚ùÑÔ∏è' },
      { id: 'aire', nombre: 'Aire', icon: Wind, emoji: 'üí®' },
      { id: 'ciclista', nombre: 'Ciclismo', icon: Bike, emoji: 'üö¥' },
      { id: 'competencias', nombre: 'Competencias', icon: Trophy, emoji: 'üèÜ' },
      { id: 'objetivos', nombre: 'Objetivos', icon: Target, emoji: 'üéØ' },
      { id: 'fitness', nombre: 'Fitness', icon: Activity, emoji: 'üí™' },
      { id: 'logros', nombre: 'Logros', icon: Award, emoji: 'üèÖ' },
      { id: 'negocios', nombre: 'Negocios', icon: Briefcase, emoji: 'üíº' },
      { id: 'caridad', nombre: 'Caridad', icon: HeartHandshake, emoji: '‚ù§Ô∏è' },
      { id: 'galeria', nombre: 'Galer√≠a', icon: Image, emoji: 'üñºÔ∏è' },
    ];

    // Funciones de utilidad
const generateRandomCoords = (centerLat, centerLon, radiusKm) => {
      const earthRadius = 6371;
  const latRad = centerLat * Math.PI / 180;
  const lonRad = centerLon * Math.PI / 180;
      const angDist = radiusKm / earthRadius;
  const randAngle = Math.random() * 2 * Math.PI;
  const randDist = Math.random() * angDist;
  const newLatRad = Math.asin(
    Math.sin(latRad) * Math.cos(randDist) +
    Math.cos(latRad) * Math.sin(randDist) * Math.cos(randAngle)
  );
  let newLonRad = lonRad + Math.atan2(
    Math.sin(randAngle) * Math.sin(randDist) * Math.cos(latRad),
    Math.cos(randDist) - Math.sin(latRad) * Math.sin(newLatRad)
  );
      newLonRad = (newLonRad + 3 * Math.PI) % (2 * Math.PI) - Math.PI;
  return {
    lat: newLatRad * 180 / Math.PI,
    lon: newLonRad * 180 / Math.PI
  };
};

const calculateDistance = (lat1, lon1, lat2, lon2) => {
      const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = 
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const distance = R * c;
      return Math.round(distance * 10) / 10;
    };

    const userLocation = { lat: -16.4090, lon: -71.5375 };
    const mapBounds = {
      minLat: -16.425,
      maxLat: -16.390,
      minLon: -71.555,
      maxLon: -71.520,
    };

    const normalizeCoords = (lat, lon) => {
      const top = 100 - ((lat - mapBounds.minLat) / (mapBounds.maxLat - mapBounds.minLat)) * 100;
      const left = ((lon - mapBounds.minLon) / (mapBounds.maxLon - mapBounds.minLon)) * 100;
      return { top: `${top}%`, left: `${left}%` };
    };

    // Datos mock
    // Nombres realistas de eventos por categor√≠a
    const eventNames = {
      anime: ['Festival de Anime Arequipa', 'Convenci√≥n Cosplay 2024', 'Proyecci√≥n de Estrenos', 'Torneo de Videojuegos Anime', 'Mercado de Merchandise'],
      cine: ['Estreno: Pel√≠cula Local', 'Ciclo de Cine Independiente', 'Noche de Cl√°sicos', 'Festival de Cortometrajes', 'Cine al Aire Libre'],
      deportes: ['Torneo de F√∫tbol 7', 'Marat√≥n de Arequipa', 'Clase de Yoga en el Parque', 'Torneo de Voleibol', 'Ciclismo Nocturno'],
      turismo: ['Tour por el Centro Hist√≥rico', 'Visita al Mirador de Yanahuara', 'Excursi√≥n al Valle del Colca', 'Tour Gastron√≥mico', 'Ruta de los Volcanes'],
      diversion: ['Fiesta Nocturna en la Plaza', 'Karaoke en Vivo', 'Noche de Juegos de Mesa', 'Festival de M√∫sica', 'Carnaval de Arequipa'],
      comida: ['Feria Gastron√≥mica', 'Taller de Cocina Peruana', 'Ruta de Picanter√≠as', 'Degustaci√≥n de Vinos', 'Mercado de Productos Locales'],
      conciertos: ['Concierto de Rock Nacional', 'Festival de Jazz', 'M√∫sica Andina en Vivo', 'DJ Set Nocturno', 'Orquesta Sinf√≥nica'],
      arte: ['Exposici√≥n de Arte Contempor√°neo', 'Taller de Pintura', 'Galer√≠a de Fotograf√≠a', 'Mural Colectivo', 'Performance Art√≠stico'],
      gaming: ['Torneo de eSports', 'Lanzamiento de Videojuegos', 'Gaming Night', 'Competencia de FIFA', 'Convenci√≥n de Gaming'],
      cultura: ['Visita al Monasterio de Santa Catalina', 'Museo de Arte Virreinal', 'Charla sobre Historia', 'Teatro Municipal', 'Biblioteca Central'],
      musica: ['Concierto Ac√∫stico', 'Festival de Folklore', 'Noche de Salsa', 'Taller de Instrumentos', 'Jam Session'],
      tech: ['Hackathon Arequipa', 'Conferencia de Tecnolog√≠a', 'Workshop de Programaci√≥n', 'Startup Pitch', 'Expo de Innovaci√≥n'],
      aire_libre: ['Senderismo al Misti', 'Camping Nocturno', 'Picnic en el Campo', 'Observaci√≥n de Estrellas', 'Caminata Ecol√≥gica'],
      educacion: ['Taller de Ingl√©s', 'Curso de Marketing Digital', 'Seminario de Negocios', 'Clase de Fotograf√≠a', 'Workshop de Dise√±o'],
      voluntariado: ['Limpieza de Playas', 'Ayuda a Animales', 'Reforestaci√≥n', 'Apoyo a Comunidades', 'Banco de Alimentos'],
      bienestar: ['Sesi√≥n de Meditaci√≥n', 'Retiro Espiritual', 'Yoga al Amanecer', 'Terapia de Sonido', 'Taller de Mindfulness'],
      aventura: ['Rappel en el Ca√±√≥n', 'Parapente sobre Arequipa', 'Escalada en Roca', 'Rafting en el R√≠o', 'Bicicleta de Monta√±a'],
      viajes: ['Tour de D√≠a Completo', 'Excursi√≥n de Fin de Semana', 'Viaje Grupal al Cusco', 'Aventura en la Selva', 'Ruta Mochilera'],
      fotografia: ['Safari Fotogr√°fico', 'Taller de Retrato', 'Fotograf√≠a Nocturna', 'Expedici√≥n Fotogr√°fica', 'Concurso de Fotograf√≠a'],
      lectura: ['Club de Lectura', 'Feria del Libro', 'Presentaci√≥n de Autor', 'Intercambio de Libros', 'Lectura en Voz Alta'],
      teatro: ['Obra de Teatro Local', 'Comedia Stand-up', 'Teatro Experimental', 'Musical en Vivo', 'Drama Cl√°sico'],
      restaurantes: ['Cena Tem√°tica', 'Brunch Especial', 'Noche de Tapas', 'Men√∫ Degustaci√≥n', 'Cocina Show'],
      automovilismo: ['Exhibici√≥n de Autos', 'Carrera de Karting', 'Rally Local', 'Show de Drift', 'Convenci√≥n de Autos'],
      aviation: ['Vuelo Panor√°mico', 'Exhibici√≥n A√©rea', 'Taller de Aviones', 'Museo Aeron√°utico', 'Experiencia de Vuelo'],
      compras: ['Feria Artesanal', 'Mercado de Antig√ºedades', 'Bazar Nocturno', 'Outlet de Ropa', 'Mercado de Pulgas'],
      regalos: ['Feria de Regalos', 'Taller de Manualidades', 'Mercado Navide√±o', 'Bazar Solidario', 'Feria de Artesan√≠a'],
      playa: ['D√≠a de Playa', 'Deportes Acu√°ticos', 'Volleyball de Playa', 'Paseo en Bote', 'Relajaci√≥n en la Arena'],
      noche: ['Pub Crawl', 'Ruta de Bares', 'Noche de Discoteca', 'Cocktail Night', 'After Party'],
      naturaleza: ['Observaci√≥n de Aves', 'Fotograf√≠a de Naturaleza', 'Senderismo Ecol√≥gico', 'Ba√±o de Bosque', 'Ecoturismo'],
      agua: ['Nataci√≥n Recreativa', 'Kayak en el Lago', 'Pesca Deportiva', 'Buceo', 'Stand Up Paddle'],
      invierno: ['Festival de Invierno', 'Noche de Fogata', 'Cocina de Temporada', 'Actividades Indoor', 'Cine Caliente'],
      aire: ['Vuelo en Parapente', 'Paracaidismo', 'Ala Delta', 'Vuelo en Globo', 'Aeromodelismo'],
      ciclista: ['Cicloturismo Urbano', 'Carrera de Bicicletas', 'Tour en Bici', 'BMX Show', 'Ciclismo de Monta√±a'],
      competencias: ['Competencia Deportiva', 'Torneo Regional', 'Campeonato Local', 'Desaf√≠o Atl√©tico', 'Competencia de Talento'],
      objetivos: ['Taller de Metas', 'Seminario de √âxito', 'Coaching Personal', 'Planificaci√≥n Estrat√©gica', 'Desarrollo Personal'],
      fitness: ['Entrenamiento Funcional', 'CrossFit al Aire Libre', 'Bootcamp', 'Zumba en el Parque', 'HIIT Training'],
      logros: ['Ceremonia de Premiaci√≥n', 'Reconocimiento a Emprendedores', 'Gala de Logros', 'Entrega de Certificados', 'Celebraci√≥n de √âxitos'],
      negocios: ['Networking Empresarial', 'Conferencia de Negocios', 'Workshop de Emprendimiento', 'Feria de Negocios', 'Mentor√≠a Empresarial'],
      caridad: ['Cena Ben√©fica', 'Marat√≥n Solidaria', 'Recaudaci√≥n de Fondos', 'Ayuda Humanitaria', 'Evento Solidario'],
      galeria: ['Inauguraci√≥n de Galer√≠a', 'Exposici√≥n Colectiva', 'Arte Urbano', 'Galer√≠a Itinerante', 'Muestra de Arte']
    };

    const organizers = [
      'Arequipa Events', 'Turismo Arequipa', 'Cultura Viva', 'Deportes AQP', 'Arte y M√°s',
      'Gastronom√≠a Peruana', 'M√∫sica en Vivo', 'Aventura Total', 'Bienestar Integral', 'Tech Arequipa'
    ];

    const locations = [
      'Plaza de Armas', 'Yanahuara', 'Cayma', 'Sachaca', 'Cerro Colorado',
      'Valle del Colca', 'Centro Hist√≥rico', 'Parque Selva Alegre', 'Miraflores', 'Alto Selva Alegre'
    ];

    const mockActivities = Array.from({ length: 60 }, (_, i) => {
  const category = categories[Math.floor(Math.random() * categories.length)];
      const { lat, lon } = generateRandomCoords(userLocation.lat, userLocation.lon, 10);
      const categoryEvents = eventNames[category.id] || [`Evento de ${category.nombre}`];
      const eventName = categoryEvents[Math.floor(Math.random() * categoryEvents.length)];
      const randomDate = new Date(Date.now() + Math.random() * 30 * 24 * 60 * 60 * 1000);
      const hours = Math.floor(Math.random() * 12) + 9; // Entre 9 AM y 9 PM
      const minutes = Math.random() > 0.5 ? 30 : 0;
      const time = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
      
      const descriptions = {
        anime: 'Sum√©rgete en el mundo del anime con proyecciones, cosplay, merchandising y mucho m√°s. Perfecto para fans del anime y manga.',
        cine: 'Disfruta de una experiencia cinematogr√°fica √∫nica con las mejores pel√≠culas y proyecciones especiales.',
        deportes: 'Actividad f√≠sica para todos los niveles. Ven a ejercitarte y conocer personas con tus mismos intereses.',
        turismo: 'Descubre los lugares m√°s hermosos de Arequipa con gu√≠as expertos y experiencias inolvidables.',
        diversion: 'Noche llena de diversi√≥n, m√∫sica, baile y entretenimiento. ¬°La pasaremos incre√≠ble!',
        comida: 'Sabores aut√©nticos de la cocina arequipe√±a. Degusta los mejores platos tradicionales y modernos.',
        conciertos: 'M√∫sica en vivo de artistas locales y nacionales. Una noche que no olvidar√°s.',
        arte: 'Explora el arte contempor√°neo y tradicional en una exposici√≥n √∫nica.',
        gaming: 'Competencia, diversi√≥n y tecnolog√≠a. Para gamers de todos los niveles.',
        cultura: 'Sum√©rgete en la rica cultura arequipe√±a y peruana.',
        musica: 'Vive la m√∫sica en su m√°xima expresi√≥n con artistas en vivo.',
        tech: 'Innovaci√≥n, tecnolog√≠a y networking. El futuro est√° aqu√≠.',
        aire_libre: 'Conecta con la naturaleza y disfruta del aire libre.',
        educacion: 'Aprende algo nuevo y expande tus conocimientos.',
        voluntariado: 'Haz la diferencia ayudando a otros y a tu comunidad.',
        bienestar: 'Rel√°jate, medita y encuentra tu equilibrio interior.',
        aventura: 'Adrenalina pura y experiencias extremas te esperan.',
        viajes: 'Explora nuevos lugares y crea recuerdos inolvidables.',
        fotografia: 'Captura momentos √∫nicos y aprende t√©cnicas profesionales.',
        lectura: 'Comparte tu pasi√≥n por los libros con otros lectores.',
        teatro: 'Disfruta de las artes esc√©nicas en su m√°xima expresi√≥n.',
        restaurantes: 'Sabores exquisitos y ambiente √∫nico te esperan.',
        automovilismo: 'Velocidad, emoci√≥n y pasi√≥n por los autos.',
        aviation: 'Vuela alto y descubre el mundo desde las alturas.',
        compras: 'Encuentra productos √∫nicos y artesan√≠as locales.',
        regalos: 'Ideas perfectas para regalar y sorprender a tus seres queridos.',
        playa: 'Rel√°jate bajo el sol y disfruta del mar.',
        noche: 'La noche es joven, ven a disfrutarla con nosotros.',
        naturaleza: 'Reconecta con la naturaleza y encuentra paz interior.',
        agua: 'Actividades acu√°ticas para toda la familia.',
        invierno: 'Actividades especiales para la temporada de invierno.',
        aire: 'Vuela libre y siente la libertad del viento.',
        ciclista: 'Pedalea por la ciudad y disfruta del ciclismo.',
        competencias: 'Demuestra tus habilidades y compite por el primer lugar.',
        objetivos: 'Define y alcanza tus metas con ayuda profesional.',
        fitness: 'Transforma tu cuerpo y mejora tu salud.',
        logros: 'Celebra los √©xitos y logros de nuestra comunidad.',
        negocios: 'Networking, aprendizaje y oportunidades de negocio.',
        caridad: 'Ayuda a quienes m√°s lo necesitan y haz el bien.',
        galeria: 'Arte, cultura y expresi√≥n en cada rinc√≥n.'
      };

      const capacity = Math.floor(Math.random() * 200) + 20;
      const registered = Math.floor(Math.random() * capacity);
      const rating = (Math.random() * 2 + 3).toFixed(1); // Entre 3.0 y 5.0
      const isFree = Math.random() > 0.4;

  return {
    id: i + 1,
        title: eventName,
    category: category.id,
    lat,
    lon,
        img: `https://picsum.photos/seed/${i + category.id}/600/400`,
        description: descriptions[category.id] || `Disfruta de una experiencia inolvidable en este evento de ${category.nombre}. Habr√° muchas sorpresas y podr√°s conocer gente nueva. ¬°No te lo pierdas!`,
        distance: calculateDistance(userLocation.lat, userLocation.lon, lat, lon),
        date: randomDate.toISOString().split('T')[0],
        time: time,
        organizer: organizers[Math.floor(Math.random() * organizers.length)],
        location: locations[Math.floor(Math.random() * locations.length)],
        price: isFree ? 'Gratis' : `S/.${(Math.random() * 80 + 15).toFixed(2)}`,
        capacity: capacity,
        registered: registered,
        available: capacity - registered,
        rating: parseFloat(rating),
        reviews: Math.floor(Math.random() * 100) + 5,
        featured: Math.random() > 0.7,
        tags: [category.nombre, isFree ? 'Gratis' : 'Pago', registered > capacity * 0.8 ? '¬°Casi lleno!' : 'Disponible']
  };
});

    // Estado global de usuario (se inicializa en App)
    let userStateGlobal = {
      plan: 'gratuito',
      inscripciones: [],
      eventosOrganizados: [],
      favoritos: [],
      preferences: null, // null = no ha completado onboarding
      gustos: [],
      estadoAnimico: null
    };

    // Cargar preferencias desde localStorage
    const loadPreferences = () => {
      try {
        const saved = localStorage.getItem('atlas_preferences');
        if (saved) {
          const parsed = JSON.parse(saved);
          userStateGlobal.preferences = parsed.preferences;
          userStateGlobal.gustos = parsed.gustos || [];
          userStateGlobal.estadoAnimico = parsed.estadoAnimico || null;
        }
      } catch (e) {
        console.error('Error loading preferences:', e);
      }
    };

    // Guardar preferencias en localStorage
    const savePreferences = (preferences) => {
      try {
        localStorage.setItem('atlas_preferences', JSON.stringify({
          preferences: preferences.preferences,
          gustos: preferences.gustos,
          estadoAnimico: preferences.estadoAnimico
        }));
      } catch (e) {
        console.error('Error saving preferences:', e);
      }
    };

    // Cargar al inicio
    loadPreferences();
    const setUserStateGlobal = (updater) => {
      if (typeof updater === 'function') {
        userStateGlobal = updater(userStateGlobal);
      } else {
        userStateGlobal = updater;
      }
      // Forzar re-render de todos los componentes
      const event = new CustomEvent('userStateUpdated', { detail: userStateGlobal });
      window.dispatchEvent(event);
    };

    // Hook de arrastre
    const useDragAnimation = (onSwipe) => {
      const [style, setStyle] = useState({ x: 0, rotate: 0, scale: 1 });
      const isDragging = useRef(false);
      const startX = useRef(0);
      const currentX = useRef(0);

      const handleStart = (e) => {
        isDragging.current = true;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        startX.current = clientX;
        currentX.current = clientX;
      };

      const handleMove = (e) => {
        if (!isDragging.current) return;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const deltaX = clientX - startX.current;
        currentX.current = clientX;
        setStyle({
          x: deltaX,
          rotate: deltaX / 10,
          scale: 1.05
        });
      };

      const handleEnd = () => {
        if (!isDragging.current) return;
        isDragging.current = false;
        const deltaX = currentX.current - startX.current;
        if (Math.abs(deltaX) > 100) {
          const isRight = deltaX > 0;
          setStyle({
            x: isRight ? window.innerWidth : -window.innerWidth,
            rotate: isRight ? 10 : -10,
            scale: 1
          });
          setTimeout(() => {
            onSwipe(isRight);
            setStyle({ x: 0, rotate: 0, scale: 1 });
          }, 300);
        } else {
          setStyle({ x: 0, rotate: 0, scale: 1 });
        }
      };

      return {
        style: {
          transform: `translateX(${style.x}px) rotate(${style.rotate}deg) scale(${style.scale})`,
          transition: isDragging.current ? 'none' : 'transform 0.3s ease-out'
        },
        onMouseDown: handleStart,
        onMouseMove: handleMove,
        onMouseUp: handleEnd,
        onMouseLeave: handleEnd,
        onTouchStart: handleStart,
        onTouchMove: handleMove,
        onTouchEnd: handleEnd,
      };
    };

    // P√ÅGINA DE INICIO
    // Funci√≥n para obtener recomendaciones personalizadas
    const getPersonalizedRecommendations = () => {
      if (!userStateGlobal.preferences) return mockActivities;
      
      const { gustos, estadoAnimico } = userStateGlobal.preferences;
      const recommendations = mockActivities.map(activity => {
        let score = 0;
        const category = categories.find(c => c.id === activity.category);
        
        // Puntaje por gustos
        if (gustos.length > 0) {
          const categoryMatch = gustos.some(gusto => {
            const categoryMap = {
              'deportes': ['deportes', 'fitness', 'competencias'],
              'arte': ['arte', 'cultura', 'galeria', 'teatro'],
              'musica': ['musica', 'conciertos'],
              'gastronomia': ['comida', 'restaurantes'],
              'naturaleza': ['naturaleza', 'aire_libre', 'agua'],
              'tecnologia': ['tech', 'gaming'],
              'aventura': ['aventura', 'aire', 'ciclista'],
              'relax': ['bienestar', 'invierno'],
              'social': ['diversion', 'noche'],
              'educacion': ['educacion'],
              'cine': ['cine'],
              'gaming': ['gaming']
            };
            return categoryMap[gusto]?.includes(activity.category);
          });
          if (categoryMatch) score += 10;
        }
        
        // Puntaje por estado an√≠mico
        if (estadoAnimico) {
          const moodMap = {
            'energico': ['deportes', 'fitness', 'aventura', 'competencias'],
            'tranquilo': ['bienestar', 'naturaleza', 'lectura', 'arte'],
            'social': ['diversion', 'noche', 'musica', 'conciertos'],
            'curioso': ['educacion', 'cultura', 'arte', 'tech'],
            'romantico': ['restaurantes', 'cultura', 'arte', 'naturaleza'],
            'aventurero': ['aventura', 'aire', 'agua', 'naturaleza', 'viajes'],
            'feliz': ['diversion', 'musica', 'comida', 'fiesta'],
            'creativo': ['arte', 'cultura', 'galeria', 'teatro'],
            'motivado': ['deportes', 'educacion', 'negocios', 'fitness'],
            'relajado': ['bienestar', 'naturaleza', 'lectura', 'agua'],
            'emocionado': ['diversion', 'noche', 'conciertos', 'aventura'],
            'nost√°lgico': ['cultura', 'arte', 'lectura', 'teatro'],
            'inspirado': ['arte', 'educacion', 'cultura', 'tech']
          };
          if (moodMap[estadoAnimico]?.includes(activity.category)) score += 15;
        }
        
        // Bonus por rating
        score += activity.rating * 2;
        
        // Bonus por featured
        if (activity.featured) score += 5;
        
        return { ...activity, personalizedScore: score };
      });
      
      return recommendations.sort((a, b) => b.personalizedScore - a.personalizedScore);
    };

    // Componente para decoraci√≥n de fondo seg√∫n estado an√≠mico
    const MoodBackgroundDecoration = memo(({ estadoAnimico }) => {
      if (!estadoAnimico) return null;

      const decorations = {
        energico: (
          <>
            {/* Rayos de energ√≠a */}
            <svg className="absolute top-10 right-10 w-32 h-32 opacity-[0.04] animate-pulse" viewBox="0 0 100 100">
              <path d="M50 10 L60 40 L90 50 L60 60 L50 90 L40 60 L10 50 L40 40 Z" fill="currentColor" className="text-yellow-400" />
              <path d="M50 20 L55 35 L70 40 L55 45 L50 60 L45 45 L30 40 L45 35 Z" fill="currentColor" className="text-amber-500" />
            </svg>
            <svg className="absolute bottom-20 left-5 w-24 h-24 opacity-[0.03] animate-pulse" style={{ animationDelay: '1s' }} viewBox="0 0 100 100">
              <path d="M50 10 L60 40 L90 50 L60 60 L50 90 L40 60 L10 50 L40 40 Z" fill="currentColor" className="text-orange-400" />
            </svg>
            <svg className="absolute top-1/2 left-20 w-20 h-20 opacity-[0.05] animate-pulse" style={{ animationDelay: '0.5s' }} viewBox="0 0 100 100">
              <path d="M50 10 L60 40 L90 50 L60 60 L50 90 L40 60 L10 50 L40 40 Z" fill="currentColor" className="text-yellow-500" />
            </svg>
          </>
        ),
        tranquilo: (
          <>
            {/* Nubes suaves */}
            <svg className="absolute top-15 left-10 w-40 h-24 opacity-[0.05] animate-pulse" viewBox="0 0 100 60">
              <path d="M20 40 Q10 30 20 20 Q30 10 40 20 Q50 10 60 20 Q70 10 80 20 Q90 20 90 30 Q100 30 90 40 Q80 50 60 50 Q50 60 40 50 Q30 60 20 50 Z" fill="currentColor" className="text-blue-300" />
            </svg>
            <svg className="absolute bottom-15 right-15 w-36 h-20 opacity-[0.04] animate-pulse" style={{ animationDelay: '1.5s' }} viewBox="0 0 100 60">
              <path d="M20 40 Q10 30 20 20 Q30 10 40 20 Q50 10 60 20 Q70 10 80 20 Q90 20 90 30 Q100 30 90 40 Q80 50 60 50 Q50 60 40 50 Q30 60 20 50 Z" fill="currentColor" className="text-cyan-300" />
            </svg>
            <svg className="absolute top-1/3 right-10 w-32 h-18 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.8s' }} viewBox="0 0 100 60">
              <path d="M20 40 Q10 30 20 20 Q30 10 40 20 Q50 10 60 20 Q70 10 80 20 Q90 20 90 30 Q100 30 90 40 Q80 50 60 50 Q50 60 40 50 Q30 60 20 50 Z" fill="currentColor" className="text-blue-200" />
            </svg>
          </>
        ),
        social: (
          <>
            {/* Estrellas y confeti */}
            <svg className="absolute top-20 left-15 w-16 h-16 opacity-[0.06] animate-pulse" viewBox="0 0 100 100">
              <polygon points="50,10 60,40 90,40 65,60 75,90 50,70 25,90 35,60 10,40 40,40" fill="currentColor" className="text-pink-400" />
            </svg>
            <svg className="absolute bottom-25 right-20 w-20 h-20 opacity-[0.05] animate-pulse" style={{ animationDelay: '0.6s' }} viewBox="0 0 100 100">
              <polygon points="50,10 60,40 90,40 65,60 75,90 50,70 25,90 35,60 10,40 40,40" fill="currentColor" className="text-rose-400" />
            </svg>
            <svg className="absolute top-1/2 right-1/4 w-14 h-14 opacity-[0.04] animate-pulse" style={{ animationDelay: '1.2s' }} viewBox="0 0 100 100">
              <polygon points="50,10 60,40 90,40 65,60 75,90 50,70 25,90 35,60 10,40 40,40" fill="currentColor" className="text-pink-300" />
            </svg>
            <svg className="absolute bottom-15 left-1/3 w-18 h-18 opacity-[0.05] animate-pulse" style={{ animationDelay: '0.3s' }} viewBox="0 0 100 100">
              <polygon points="50,10 60,40 90,40 65,60 75,90 50,70 25,90 35,60 10,40 40,40" fill="currentColor" className="text-rose-300" />
            </svg>
          </>
        ),
        curioso: (
          <>
            {/* Lupa y libros */}
            <svg className="absolute top-12 right-12 w-28 h-28 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="30" fill="none" stroke="currentColor" strokeWidth="4" className="text-purple-400" />
              <line x1="70" y1="70" x2="85" y2="85" stroke="currentColor" strokeWidth="4" className="text-purple-400" />
            </svg>
            <svg className="absolute bottom-20 left-12 w-24 h-24 opacity-[0.04] animate-pulse" style={{ animationDelay: '1s' }} viewBox="0 0 100 100">
              <rect x="20" y="30" width="60" height="8" rx="2" fill="currentColor" className="text-indigo-400" />
              <rect x="20" y="45" width="50" height="8" rx="2" fill="currentColor" className="text-indigo-400" />
              <rect x="20" y="60" width="55" height="8" rx="2" fill="currentColor" className="text-indigo-400" />
            </svg>
            <svg className="absolute top-1/3 left-20 w-20 h-20 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.5s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" strokeWidth="3" className="text-purple-300" />
            </svg>
          </>
        ),
        romantico: (
          <>
            {/* Corazones */}
            <svg className="absolute top-15 right-15 w-32 h-28 opacity-[0.06] animate-pulse" viewBox="0 0 100 90">
              <path d="M50 15 C50 15, 20 10, 20 35 C20 50, 50 70, 50 70 C50 70, 80 50, 80 35 C80 10, 50 15, 50 15 Z" fill="currentColor" className="text-red-400" />
            </svg>
            <svg className="absolute bottom-20 left-15 w-28 h-24 opacity-[0.05] animate-pulse" style={{ animationDelay: '1.2s' }} viewBox="0 0 100 90">
              <path d="M50 15 C50 15, 20 10, 20 35 C20 50, 50 70, 50 70 C50 70, 80 50, 80 35 C80 10, 50 15, 50 15 Z" fill="currentColor" className="text-pink-400" />
            </svg>
            <svg className="absolute top-1/2 right-1/4 w-24 h-20 opacity-[0.04] animate-pulse" style={{ animationDelay: '0.6s' }} viewBox="0 0 100 90">
              <path d="M50 15 C50 15, 20 10, 20 35 C20 50, 50 70, 50 70 C50 70, 80 50, 80 35 C80 10, 50 15, 50 15 Z" fill="currentColor" className="text-rose-400" />
            </svg>
            <svg className="absolute bottom-15 right-1/3 w-20 h-18 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.3s' }} viewBox="0 0 100 90">
              <path d="M50 15 C50 15, 20 10, 20 35 C20 50, 50 70, 50 70 C50 70, 80 50, 80 35 C80 10, 50 15, 50 15 Z" fill="currentColor" className="text-red-300" />
            </svg>
          </>
        ),
        aventurero: (
          <>
            {/* Monta√±as y br√∫jula */}
            <svg className="absolute bottom-20 right-10 w-40 h-30 opacity-[0.05] animate-pulse" viewBox="0 0 100 80">
              <polygon points="0,80 20,40 40,60 60,20 80,50 100,30 100,80" fill="currentColor" className="text-green-400" />
            </svg>
            <svg className="absolute top-20 left-10 w-28 h-28 opacity-[0.04] animate-pulse" style={{ animationDelay: '0.8s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="35" fill="none" stroke="currentColor" strokeWidth="3" className="text-emerald-400" />
              <line x1="50" y1="15" x2="50" y2="50" stroke="currentColor" strokeWidth="2" className="text-emerald-400" />
              <polygon points="50,15 45,25 50,20 55,25" fill="currentColor" className="text-emerald-400" />
            </svg>
            <svg className="absolute top-1/3 right-1/3 w-24 h-18 opacity-[0.03] animate-pulse" style={{ animationDelay: '1.5s' }} viewBox="0 0 100 80">
              <polygon points="0,80 15,50 30,65 50,25 70,55 100,40 100,80" fill="currentColor" className="text-green-300" />
            </svg>
          </>
        ),
        feliz: (
          <>
            {/* Sonrisas y soles */}
            <svg className="absolute top-12 left-12 w-28 h-28 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="35" fill="none" stroke="currentColor" strokeWidth="3" className="text-yellow-400" />
              <circle cx="35" cy="40" r="4" fill="currentColor" className="text-yellow-400" />
              <circle cx="65" cy="40" r="4" fill="currentColor" className="text-yellow-400" />
              <path d="M35 60 Q50 70 65 60" stroke="currentColor" strokeWidth="3" fill="none" className="text-yellow-400" />
            </svg>
            <svg className="absolute bottom-15 right-15 w-24 h-24 opacity-[0.04] animate-pulse" style={{ animationDelay: '1s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="30" fill="none" stroke="currentColor" strokeWidth="3" className="text-amber-400" />
              <circle cx="35" cy="40" r="3" fill="currentColor" className="text-amber-400" />
              <circle cx="65" cy="40" r="3" fill="currentColor" className="text-amber-400" />
              <path d="M35 60 Q50 70 65 60" stroke="currentColor" strokeWidth="3" fill="none" className="text-amber-400" />
            </svg>
            <svg className="absolute top-1/3 right-1/4 w-20 h-20 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.5s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" strokeWidth="2" className="text-yellow-300" />
            </svg>
          </>
        ),
        creativo: (
          <>
            {/* Paleta y pinceles */}
            <svg className="absolute top-15 right-10 w-30 h-30 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <ellipse cx="50" cy="50" rx="25" ry="30" fill="currentColor" className="text-purple-400" />
              <rect x="45" y="20" width="10" height="40" rx="2" fill="currentColor" className="text-purple-500" />
            </svg>
            <svg className="absolute bottom-20 left-10 w-26 h-26 opacity-[0.04] animate-pulse" style={{ animationDelay: '1.2s' }} viewBox="0 0 100 100">
              <path d="M30 20 L70 20 L65 60 L35 60 Z" fill="currentColor" className="text-indigo-400" />
              <line x1="50" y1="20" x2="50" y2="60" stroke="currentColor" strokeWidth="2" className="text-indigo-500" />
            </svg>
            <svg className="absolute top-1/2 left-1/4 w-22 h-22 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.7s' }} viewBox="0 0 100 100">
              <rect x="40" y="30" width="20" height="50" rx="3" fill="currentColor" className="text-purple-300" />
            </svg>
          </>
        ),
        motivado: (
          <>
            {/* Flechas y metas */}
            <svg className="absolute top-10 left-15 w-32 h-32 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <path d="M20 50 L50 20 L50 40 L80 40 L80 60 L50 60 L50 80 Z" fill="currentColor" className="text-blue-500" />
            </svg>
            <svg className="absolute bottom-15 right-12 w-28 h-28 opacity-[0.04] animate-pulse" style={{ animationDelay: '1s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" strokeWidth="3" className="text-blue-400" />
              <path d="M50 30 L50 50 L65 50" stroke="currentColor" strokeWidth="3" fill="none" className="text-blue-400" />
            </svg>
            <svg className="absolute top-1/3 right-1/3 w-24 h-24 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.6s' }} viewBox="0 0 100 100">
              <path d="M30 50 L50 30 L50 45 L70 45 L70 55 L50 55 L50 70 Z" fill="currentColor" className="text-cyan-400" />
            </svg>
          </>
        ),
        relajado: (
          <>
            {/* Olas y hojas */}
            <svg className="absolute bottom-20 left-10 w-40 h-20 opacity-[0.05] animate-pulse" viewBox="0 0 100 50">
              <path d="M0 30 Q20 20 40 30 T80 30 T100 30 L100 50 L0 50 Z" fill="currentColor" className="text-teal-300" />
            </svg>
            <svg className="absolute top-20 right-10 w-28 h-28 opacity-[0.04] animate-pulse" style={{ animationDelay: '1.3s' }} viewBox="0 0 100 100">
              <path d="M50 20 Q40 30 50 40 Q60 30 50 20" fill="currentColor" className="text-green-300" />
              <path d="M50 40 Q45 50 50 60 Q55 50 50 40" fill="currentColor" className="text-green-300" />
            </svg>
            <svg className="absolute top-1/2 left-1/3 w-24 h-16 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.8s' }} viewBox="0 0 100 50">
              <path d="M0 35 Q25 25 50 35 T100 35 L100 50 L0 50 Z" fill="currentColor" className="text-teal-200" />
            </svg>
          </>
        ),
        emocionado: (
          <>
            {/* Fuegos artificiales */}
            <svg className="absolute top-15 right-15 w-24 h-24 opacity-[0.06] animate-pulse" viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="3" fill="currentColor" className="text-yellow-400" />
              <line x1="50" y1="50" x2="30" y2="30" stroke="currentColor" strokeWidth="2" className="text-yellow-400" />
              <line x1="50" y1="50" x2="70" y2="30" stroke="currentColor" strokeWidth="2" className="text-yellow-400" />
              <line x1="50" y1="50" x2="30" y2="70" stroke="currentColor" strokeWidth="2" className="text-yellow-400" />
              <line x1="50" y1="50" x2="70" y2="70" stroke="currentColor" strokeWidth="2" className="text-yellow-400" />
            </svg>
            <svg className="absolute bottom-20 left-15 w-20 h-20 opacity-[0.05] animate-pulse" style={{ animationDelay: '0.9s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="2" fill="currentColor" className="text-orange-400" />
              <line x1="50" y1="50" x2="25" y2="25" stroke="currentColor" strokeWidth="2" className="text-orange-400" />
              <line x1="50" y1="50" x2="75" y2="25" stroke="currentColor" strokeWidth="2" className="text-orange-400" />
              <line x1="50" y1="50" x2="25" y2="75" stroke="currentColor" strokeWidth="2" className="text-orange-400" />
              <line x1="50" y1="50" x2="75" y2="75" stroke="currentColor" strokeWidth="2" className="text-orange-400" />
            </svg>
            <svg className="absolute top-1/3 left-1/4 w-18 h-18 opacity-[0.04] animate-pulse" style={{ animationDelay: '0.4s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="2" fill="currentColor" className="text-pink-400" />
              <line x1="50" y1="50" x2="20" y2="50" stroke="currentColor" strokeWidth="2" className="text-pink-400" />
              <line x1="50" y1="50" x2="80" y2="50" stroke="currentColor" strokeWidth="2" className="text-pink-400" />
              <line x1="50" y1="50" x2="50" y2="20" stroke="currentColor" strokeWidth="2" className="text-pink-400" />
              <line x1="50" y1="50" x2="50" y2="80" stroke="currentColor" strokeWidth="2" className="text-pink-400" />
            </svg>
          </>
        ),
        nost√°lgico: (
          <>
            {/* Estrellas y luna */}
            <svg className="absolute top-12 right-12 w-28 h-28 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <path d="M50 20 A30 30 0 1 1 50 80 A30 30 0 1 1 50 20 Z" fill="currentColor" className="text-indigo-300" />
            </svg>
            <svg className="absolute bottom-18 left-12 w-20 h-20 opacity-[0.04] animate-pulse" style={{ animationDelay: '1.1s' }} viewBox="0 0 100 100">
              <polygon points="50,10 55,35 80,35 60,50 65,75 50,60 35,75 40,50 20,35 45,35" fill="currentColor" className="text-blue-200" />
            </svg>
            <svg className="absolute top-1/2 right-1/4 w-16 h-16 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.7s' }} viewBox="0 0 100 100">
              <polygon points="50,10 53,30 70,30 58,42 65,60 50,50 35,60 42,42 30,30 47,30" fill="currentColor" className="text-indigo-200" />
            </svg>
          </>
        ),
        inspirado: (
          <>
            {/* Bombilla y chispas */}
            <svg className="absolute top-15 left-15 w-26 h-26 opacity-[0.05] animate-pulse" viewBox="0 0 100 100">
              <circle cx="50" cy="40" r="20" fill="none" stroke="currentColor" strokeWidth="3" className="text-yellow-400" />
              <rect x="45" y="60" width="10" height="15" rx="2" fill="currentColor" className="text-yellow-500" />
              <line x1="40" y1="75" x2="60" y2="75" stroke="currentColor" strokeWidth="2" className="text-yellow-500" />
            </svg>
            <svg className="absolute bottom-20 right-12 w-22 h-22 opacity-[0.04] animate-pulse" style={{ animationDelay: '1s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="2" fill="currentColor" className="text-amber-400" />
              <line x1="50" y1="50" x2="35" y2="35" stroke="currentColor" strokeWidth="2" className="text-amber-400" />
              <line x1="50" y1="50" x2="65" y2="35" stroke="currentColor" strokeWidth="2" className="text-amber-400" />
              <line x1="50" y1="50" x2="35" y2="65" stroke="currentColor" strokeWidth="2" className="text-amber-400" />
              <line x1="50" y1="50" x2="65" y2="65" stroke="currentColor" strokeWidth="2" className="text-amber-400" />
            </svg>
            <svg className="absolute top-1/3 right-1/3 w-18 h-18 opacity-[0.03] animate-pulse" style={{ animationDelay: '0.5s' }} viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="15" fill="none" stroke="currentColor" strokeWidth="2" className="text-yellow-300" />
            </svg>
          </>
        )
      };

      return (
        <div className="absolute inset-0 pointer-events-none overflow-hidden z-0">
          {decorations[estadoAnimico] || null}
        </div>
      );
    });

const PageHome = memo(() => {
      const personalizedActivities = getPersonalizedRecommendations();
      const topRecommendations = personalizedActivities.slice(0, 5);
      const [userState, setUserState] = useState(userStateGlobal);
      
      useEffect(() => {
        const handleUpdate = (e) => {
          setUserState(e.detail);
        };
        window.addEventListener('userStateUpdated', handleUpdate);
        return () => window.removeEventListener('userStateUpdated', handleUpdate);
      }, []);
      
      const quickSuggestions = [
        { id: 'aniversario', label: 'üéâ Aniversario', search: 'aniversario celebraci√≥n fiesta' },
        { id: 'salida', label: 'üö∂ Salida', search: 'salida paseo caminata' },
        { id: 'romantico', label: 'üíï Rom√°ntico', search: 'rom√°ntico cena pareja' },
        { id: 'familiar', label: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familiar', search: 'familiar ni√±os familia' },
        { id: 'aventura', label: 'üèîÔ∏è Aventura', search: 'aventura extremo deporte' }
      ];

      const handleQuickSuggestion = (suggestion) => {
        const event = new CustomEvent('quickSearch', { detail: suggestion.search });
        window.dispatchEvent(event);
        // Cambiar a la vista de filtros
        const navEvent = new CustomEvent('navigateTo', { detail: 'filters' });
        window.dispatchEvent(navEvent);
      };

  return (
        <div className="relative flex flex-col items-center h-full p-3 sm:p-4 lg:p-5 text-center bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 overflow-y-auto">
          <MoodBackgroundDecoration estadoAnimico={userState.estadoAnimico} />
          <div className="relative z-10 w-full max-w-4xl space-y-3 sm:space-y-4">
            {/* Header con icono y t√≠tulo */}
            <div className="flex flex-col items-center">
              <img src="logo.png" alt="Eventum" className="w-24 h-24 sm:w-28 sm:h-28 rounded-2xl object-cover float-animation mb-2 sm:mb-3" />
              <h1 className="text-lg sm:text-xl lg:text-2xl font-sf-display font-bold text-gold-gradient slide-in">
                Hola, ¬øqu√© te gustar√≠a hacer hoy?
              </h1>
              <p className="mt-1 text-xs sm:text-sm text-gray-700 font-sf-text">
                Tu asistente de actividades est√° listo para ayudarte.
              </p>
            </div>

            {/* Barra de b√∫squeda */}
            <div className="w-full max-w-md mx-auto scale-in">
              <div className="flex w-full overflow-hidden border-2 border-amber-400/60 rounded-xl shadow-[0_8px_25px_rgba(212,175,55,0.3)] bg-white card-hover shimmer">
          <input
            type="text"
            placeholder="P√≠deme algo, ej: 'ideas para esta noche'"
                  className="flex-grow p-3 sm:p-4 text-gray-700 outline-none font-sf-text text-xs sm:text-sm bg-white focus:ring-2 focus:ring-amber-500/50"
          />
                <button className="flex-shrink-0 px-4 sm:px-5 py-2 sm:py-3 m-1 bg-gradient-to-br from-yellow-300 via-amber-400 to-amber-600 text-white rounded-lg shadow-[0_4px_15px_rgba(212,175,55,0.5)] hover:shadow-[0_6px_20px_rgba(212,175,55,0.6)] transition-all duration-300 transform hover:scale-105 border border-yellow-200/30">
                  <ChevronRight className="w-5 h-5 sm:w-6 sm:h-6 drop-shadow-sm" />
          </button>
        </div>
      </div>
      
            {/* Recomendaciones personalizadas */}
            {userStateGlobal.preferences && topRecommendations.length > 0 && (
              <div className="w-full max-w-2xl mx-auto">
                <h3 className="text-xs sm:text-sm font-semibold text-gray-700 mb-2 flex items-center justify-center gap-2">
                  <Sparkles className="w-3 h-3 sm:w-4 sm:h-4 text-amber-500" />
                  Recomendaciones para ti
                </h3>
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-3">
                  {topRecommendations.slice(0, 4).map(activity => {
                    const category = categories.find(c => c.id === activity.category);
                    return (
                      <div
                        key={activity.id}
                        onClick={() => {
                          const event = new CustomEvent('showEventDetails', { detail: activity });
                          window.dispatchEvent(event);
                        }}
                        className="p-2 sm:p-2.5 bg-gradient-to-br from-amber-50/80 to-yellow-50/80 border-2 border-amber-400/50 rounded-lg shadow-[0_4px_12px_rgba(212,175,55,0.2)] hover:shadow-[0_6px_20px_rgba(212,175,55,0.3)] transition-all cursor-pointer card-hover backdrop-blur-sm"
                      >
                        <div className="flex flex-col items-center gap-1 mb-1">
                          <span className="text-xl sm:text-2xl">{category?.emoji}</span>
                          <h4 className="text-[10px] sm:text-xs font-semibold text-gray-800 text-center line-clamp-2 leading-tight">{activity.title}</h4>
                        </div>
                        <div className="flex items-center justify-center gap-1 text-[10px] text-gray-600">
                          <Star className="w-2.5 h-2.5 text-amber-500 fill-amber-500" />
                          <span>{activity.rating}</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}

            {/* Sugerencias R√°pidas */}
            <div className="w-full max-w-2xl mx-auto">
              <h3 className="text-xs sm:text-sm font-semibold text-gray-700 mb-2">Sugerencias R√°pidas</h3>
              <div className="flex flex-wrap justify-center gap-1.5 sm:gap-2 mb-3">
                {quickSuggestions.map(suggestion => (
                  <button
                    key={suggestion.id}
                    onClick={() => handleQuickSuggestion(suggestion)}
                    className="px-2.5 sm:px-3 py-1.5 sm:py-2 text-[10px] sm:text-xs font-medium bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-400/60 rounded-full shadow-[0_2px_8px_rgba(212,175,55,0.2)] hover:shadow-[0_4px_12px_rgba(212,175,55,0.3)] hover:border-amber-500/80 transition-all transform hover:scale-105 card-hover text-amber-800"
                  >
                    {suggestion.label}
                  </button>
                ))}
              </div>
            </div>

            {/* Botones principales */}
            <div className="flex flex-wrap justify-center gap-2 sm:gap-3">
              <button className="flex items-center gap-1 sm:gap-1.5 px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-sf-text font-medium bg-gradient-to-br from-yellow-300 via-amber-400 to-amber-600 text-white rounded-full shadow-[0_4px_15px_rgba(212,175,55,0.5)] hover:shadow-[0_6px_25px_rgba(212,175,55,0.6)] transition-all transform hover:scale-105 card-hover glow-animation border border-yellow-200/30">
                <Sparkles className="w-3 h-3 sm:w-4 sm:h-4 drop-shadow-sm" />
                Dame Ideas
              </button>
              <button className="flex items-center gap-1 sm:gap-1.5 px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-sf-text font-medium text-amber-800 bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-400/60 rounded-full shadow-[0_4px_12px_rgba(212,175,55,0.2)] hover:shadow-[0_6px_18px_rgba(212,175,55,0.3)] hover:border-amber-500/80 transition-all transform hover:scale-105 card-hover">
                <Users className="w-3 h-3 sm:w-4 sm:h-4 text-amber-700" />
                Conocer Gente
              </button>
              <button className="flex items-center gap-1 sm:gap-1.5 px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-sf-text font-medium text-amber-800 bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-400/60 rounded-full shadow-[0_4px_12px_rgba(212,175,55,0.2)] hover:shadow-[0_6px_18px_rgba(212,175,55,0.3)] hover:border-amber-500/80 transition-all transform hover:scale-105 card-hover">
                <Shuffle className="w-3 h-3 sm:w-4 sm:h-4 text-amber-700" />
                Sorpr√©ndeme
              </button>
            </div>
          </div>
        </div>
      );
    });

    // P√ÅGINA DE SWIPE
const PageSwipe = memo(() => {
  const [activityIndex, setActivityIndex] = useState(0);
  const [liked, setLiked] = useState([]);
      const [removedActivities, setRemovedActivities] = useState([]);

      const handleSwipe = (isRight) => {
        const currentActivity = mockActivities[activityIndex];
        if (!currentActivity) return;
          if (isRight) {
          setLiked(prev => [...prev, currentActivity.id]);
          setUserStateGlobal(prev => ({
            ...prev,
            inscripciones: [...prev.inscripciones, currentActivity]
          }));
        }
        setRemovedActivities(prev => [...prev, currentActivity]);
          setActivityIndex(prev => prev + 1);
      };

      const dragProps = useDragAnimation(handleSwipe);

  const handleAction = (action) => {
        const currentActivity = mockActivities[activityIndex];
    if (!currentActivity) return;
    const isRight = action === 'like';
        if (isRight) {
          setLiked(prev => [...prev, currentActivity.id]);
          setUserStateGlobal(prev => ({
            ...prev,
            inscripciones: [...prev.inscripciones, currentActivity]
          }));
        }
        setRemovedActivities(prev => [...prev, currentActivity]);
        setActivityIndex(prev => prev + 1);
  };

  const handleUndo = () => {
    if (removedActivities.length > 0) {
      const lastRemoved = removedActivities[removedActivities.length - 1];
      setActivityIndex(prev => prev - 1);
      setRemovedActivities(prev => prev.slice(0, prev.length - 1));
      setLiked(prev => prev.filter(id => id !== lastRemoved.id));
          setUserStateGlobal(prev => ({
            ...prev,
            inscripciones: prev.inscripciones.filter(a => a.id !== lastRemoved.id)
          }));
    }
  };

      const currentActivity = mockActivities[activityIndex];
      const nextActivity = mockActivities[activityIndex + 1];

  return (
        <div className="flex flex-col items-center justify-center h-full p-4 lg:p-6 overflow-hidden bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 font-sf-text">
          <div className="relative w-full max-w-sm lg:max-w-md" style={{ height: 'calc(100vh - 200px)' }}>
        {nextActivity && (
          <div className="absolute w-full h-full p-4 bg-gray-50 rounded-3xl shadow-md transform scale-95 -bottom-4">
            <div className="w-full h-full bg-gray-100 rounded-2xl animate-pulse"></div>
          </div>
        )}

        {currentActivity ? (
              <div 
                {...dragProps}
                className="absolute w-full h-full bg-white rounded-3xl shadow-2xl overflow-hidden will-change-transform cursor-grab active:cursor-grabbing border-2 border-amber-200 scale-in"
              >
                <div className="relative w-full h-3/5 overflow-hidden">
            <img 
              src={currentActivity.img} 
              alt={currentActivity.title} 
                    className="object-cover w-full h-full"
              onError={(e) => e.target.src = 'https://placehold.co/600x400/dddddd/666666?text=Imagen+No+Disponible'}
            />
                  <div className="absolute top-4 left-4 right-4 flex items-center justify-between">
                    <span className="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-semibold text-white bg-gradient-to-r from-yellow-400 via-amber-500 to-amber-600 rounded-full shadow-[0_4px_15px_rgba(212,175,55,0.5)] backdrop-blur-sm glow-animation border border-yellow-200/30">
                  {categories.find(c => c.id === currentActivity.category)?.emoji}
                  {categories.find(c => c.id === currentActivity.category)?.nombre || 'General'}
                </span>
                    <span className="inline-flex items-center gap-1 px-3 py-1.5 text-xs font-semibold text-white bg-black bg-opacity-50 rounded-full backdrop-blur-sm">
                      <Compass className="w-3 h-3" />
                  {currentActivity.distance} km
                </span>
              </div>
                </div>
                <div className="p-4 sm:p-6 bg-gradient-to-b from-white to-amber-50">
                  <div className="flex items-start justify-between mb-2">
                    <div className="flex-1">
                      <h2 className="text-xl sm:text-2xl font-sf-display font-bold text-gold-gradient mb-1">
                {currentActivity.title}
              </h2>
                      <div className="flex items-center gap-2 text-xs text-gray-600 mb-2">
                        <span className="flex items-center gap-1">
                          <Star className="w-3 h-3 text-amber-500 fill-amber-500" />
                          {currentActivity.rating} ({currentActivity.reviews})
                        </span>
                        <span className="flex items-center gap-1">
                          <MapPin2 className="w-3 h-3" />
                          {currentActivity.location}
                        </span>
                      </div>
                    </div>
                    {currentActivity.featured && (
                      <span className="px-2 py-1 text-[10px] font-bold text-white bg-gradient-to-r from-yellow-400 via-amber-500 to-amber-600 rounded-full shadow-[0_2px_8px_rgba(212,175,55,0.5)] border border-yellow-200/30">
                        DESTACADO
                      </span>
                    )}
                  </div>
                  <p className="mt-2 text-xs sm:text-sm text-gray-700 line-clamp-2 leading-relaxed mb-3">
                {currentActivity.description}
              </p>
                  <div className="flex items-center justify-between text-xs text-gray-600 flex-wrap gap-2">
                    <div className="flex items-center gap-3">
                      <span className="flex items-center gap-1">
                        <Calendar className="w-3 h-3 text-amber-600" />
                        {new Date(currentActivity.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short' })}
                      </span>
                      <span className="flex items-center gap-1">
                        <Clock className="w-3 h-3 text-amber-600" />
                        {currentActivity.time}
                      </span>
            </div>
                    <div className="flex items-center gap-2">
                      <span className="px-2 py-0.5 bg-amber-100 text-amber-700 rounded-full font-medium">
                        {currentActivity.price}
                      </span>
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full">
                        {currentActivity.available} cupos
                      </span>
                    </div>
                  </div>
                </div>
              </div>
        ) : (
          <div className="absolute inset-0 flex flex-col items-center justify-center text-center bg-white rounded-3xl shadow-xl p-6">
                <RotateCcw className="w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-300" />
                <h2 className="mt-4 text-xl sm:text-2xl font-sf-display font-semibold text-gray-700">¬°Eso es todo por ahora!</h2>
                <p className="mt-2 text-sm text-gray-500 font-sf-text">Vuelve m√°s tarde para ver nuevas actividades.</p>
            <button 
              onClick={() => {
                setActivityIndex(0);
                setLiked([]);
                setRemovedActivities([]);
              }}
              className="mt-6 px-6 py-3 font-sf-text text-white bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full shadow-md hover:from-yellow-500 hover:to-yellow-700 transition-transform transform hover:scale-105"
            >
              Reiniciar Exploraci√≥n
            </button>
          </div>
        )}
      </div>

      {currentActivity && (
            <div className="flex justify-center gap-4 sm:gap-6 mt-6 sm:mt-8 w-full max-w-sm">
          <button 
            onClick={handleUndo}
            disabled={removedActivities.length === 0}
                className={`flex items-center justify-center w-14 h-14 sm:w-16 sm:h-16 bg-gray-100 rounded-full shadow-lg text-gray-600 transform transition-transform hover:scale-110 ${removedActivities.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}`}
            aria-label="Deshacer"
          >
                <RotateCcw className="w-7 h-7 sm:w-8 sm:h-8" />
          </button>
          <button 
            onClick={() => handleAction('dislike')}
                className="flex items-center justify-center w-18 h-18 sm:w-20 sm:h-20 bg-white rounded-full shadow-2xl text-red-500 transform transition-transform hover:scale-110"
            aria-label="Saltar"
          >
                <X className="w-9 h-9 sm:w-10 sm:h-10" />
          </button>
          <button 
            onClick={() => handleAction('like')}
                className="flex items-center justify-center w-18 h-18 sm:w-20 sm:h-20 bg-white rounded-full shadow-2xl text-green-500 transform transition-transform hover:scale-110"
            aria-label="Me Gusta"
          >
                <Heart className="w-9 h-9 sm:w-10 sm:h-10" fill="currentColor" />
          </button>
        </div>
      )}
    </div>
  );
});

    // P√ÅGINA DE FILTROS
const PageFilters = memo(() => {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategories, setSelectedCategories] = useState([]);
      const [filterDate, setFilterDate] = useState('');
      const [filterPrice, setFilterPrice] = useState('all');
      const [sortBy, setSortBy] = useState('distance');
      const [timeFrom, setTimeFrom] = useState('');
      const [timeTo, setTimeTo] = useState('');
      const [quickFilters, setQuickFilters] = useState([]);

      const quickFilterOptions = [
        { id: 'aniversario', label: 'üéâ Aniversario', keywords: ['aniversario', 'celebraci√≥n', 'fiesta', 'cumplea√±os'] },
        { id: 'salida', label: 'üö∂ Salida', keywords: ['salida', 'paseo', 'caminata', 'excursi√≥n'] },
        { id: 'romantico', label: 'üíï Rom√°ntico', keywords: ['rom√°ntico', 'cena', 'pareja', 'intimidad'] },
        { id: 'familiar', label: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familiar', keywords: ['familiar', 'ni√±os', 'familia', 'infantil'] },
        { id: 'aventura', label: 'üèîÔ∏è Aventura', keywords: ['aventura', 'extremo', 'deporte', 'adrenalina'] },
        { id: 'relax', label: 'üßò Relajante', keywords: ['relax', 'spa', 'yoga', 'meditaci√≥n', 'bienestar'] },
        { id: 'gastronomia', label: 'üçΩÔ∏è Gastronom√≠a', keywords: ['comida', 'restaurante', 'gastronom√≠a', 'degustaci√≥n'] },
        { id: 'cultural', label: 'üé≠ Cultural', keywords: ['cultura', 'arte', 'museo', 'teatro', 'exposici√≥n'] }
      ];

      useEffect(() => {
        const handleQuickSearch = (e) => {
          setSearchTerm(e.detail);
        };
        window.addEventListener('quickSearch', handleQuickSearch);
        return () => window.removeEventListener('quickSearch', handleQuickSearch);
      }, []);

  const toggleCategory = (categoryId) => {
    setSelectedCategories(prev =>
      prev.includes(categoryId)
        ? prev.filter(id => id !== categoryId)
        : [...prev, categoryId]
    );
  };

  const filteredActivities = useMemo(() => {
        let filtered = mockActivities.filter(activity => {
          const matchesSearch = activity.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                               activity.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                               activity.location.toLowerCase().includes(searchTerm.toLowerCase());
      const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(activity.category);
          const matchesDate = !filterDate || activity.date === filterDate;
          const matchesPrice = filterPrice === 'all' || 
                              (filterPrice === 'free' && activity.price === 'Gratis') ||
                              (filterPrice === 'paid' && activity.price !== 'Gratis');
          
          // Filtro de rango horario
          let matchesTime = true;
          if (timeFrom && timeTo) {
            const activityTime = activity.time;
            const [activityHour, activityMin] = activityTime.split(':').map(Number);
            const [fromHour, fromMin] = timeFrom.split(':').map(Number);
            const [toHour, toMin] = timeTo.split(':').map(Number);
            
            const activityMinutes = activityHour * 60 + activityMin;
            const fromMinutes = fromHour * 60 + fromMin;
            const toMinutes = toHour * 60 + toMin;
            
            matchesTime = activityMinutes >= fromMinutes && activityMinutes <= toMinutes;
          } else if (timeFrom) {
            const [activityHour, activityMin] = activity.time.split(':').map(Number);
            const [fromHour, fromMin] = timeFrom.split(':').map(Number);
            const activityMinutes = activityHour * 60 + activityMin;
            const fromMinutes = fromHour * 60 + fromMin;
            matchesTime = activityMinutes >= fromMinutes;
          } else if (timeTo) {
            const [activityHour, activityMin] = activity.time.split(':').map(Number);
            const [toHour, toMin] = timeTo.split(':').map(Number);
            const activityMinutes = activityHour * 60 + activityMin;
            const toMinutes = toHour * 60 + toMin;
            matchesTime = activityMinutes <= toMinutes;
          }

          // Filtros r√°pidos
          let matchesQuickFilters = true;
          if (quickFilters.length > 0) {
            matchesQuickFilters = quickFilters.some(filterId => {
              const filter = quickFilterOptions.find(f => f.id === filterId);
              if (!filter) return false;
              const searchText = `${activity.title} ${activity.description} ${activity.location}`.toLowerCase();
              return filter.keywords.some(keyword => searchText.includes(keyword));
            });
          }

          return matchesSearch && matchesCategory && matchesDate && matchesPrice && matchesTime && matchesQuickFilters;
        });

        // Ordenar
        filtered.sort((a, b) => {
          switch(sortBy) {
            case 'distance':
              return a.distance - b.distance;
            case 'rating':
              return b.rating - a.rating;
            case 'date':
              return new Date(a.date) - new Date(b.date);
            case 'price':
              const priceA = a.price === 'Gratis' ? 0 : parseFloat(a.price.replace('S/.', ''));
              const priceB = b.price === 'Gratis' ? 0 : parseFloat(b.price.replace('S/.', ''));
              return priceA - priceB;
            default:
              return 0;
          }
        });

        return filtered;
      }, [searchTerm, selectedCategories, filterDate, filterPrice, sortBy, timeFrom, timeTo, quickFilters]);

      return (
        <div className="p-4 sm:p-5 lg:p-8 bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 font-sf-text h-full overflow-y-auto">
          <h1 className="text-2xl sm:text-3xl lg:text-4xl font-sf-display font-bold text-gold-gradient mb-4 sm:mb-6 slide-in">Buscar Actividades</h1>
          <div className="relative mb-4 sm:mb-6">
        <input
          type="text"
          placeholder="Buscar por nombre..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full p-3 sm:p-4 pl-12 sm:pl-14 text-sm sm:text-base border-2 border-amber-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white shadow-lg card-hover shimmer"
            />
            <Search className="absolute w-5 h-5 sm:w-6 sm:h-6 text-amber-600 left-4 sm:left-5 top-1/2 -translate-y-1/2 glow-animation" />
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
            <div>
              <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Fecha</label>
              <input
                type="date"
                value={filterDate}
                onChange={(e) => setFilterDate(e.target.value)}
                className="w-full p-2 text-xs sm:text-sm border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
              />
            </div>
            <div>
              <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Precio</label>
              <select
                value={filterPrice}
                onChange={(e) => setFilterPrice(e.target.value)}
                className="w-full p-2 text-xs sm:text-sm border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
              >
                <option value="all">Todos</option>
                <option value="free">Gratis</option>
                <option value="paid">De pago</option>
              </select>
            </div>
            <div>
              <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Ordenar por</label>
              <select
                value={sortBy}
                onChange={(e) => setSortBy(e.target.value)}
                className="w-full p-2 text-xs sm:text-sm border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
              >
                <option value="distance">Distancia</option>
                <option value="rating">Mejor valorados</option>
                <option value="date">Fecha</option>
                <option value="price">Precio</option>
              </select>
            </div>
      </div>

          <div className="mb-4 p-4 bg-amber-50 rounded-xl border-2 border-amber-200">
            <label className="block text-sm sm:text-base font-semibold text-gray-800 mb-3">
              üïê Disponibilidad Horaria
            </label>
            <div className="grid grid-cols-2 gap-3">
              <div>
                <label className="block text-xs text-gray-600 mb-1">Desde</label>
                <input
                  type="time"
                  value={timeFrom}
                  onChange={(e) => setTimeFrom(e.target.value)}
                  className="w-full p-2 text-xs sm:text-sm border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
                  placeholder="09:00"
                />
              </div>
              <div>
                <label className="block text-xs text-gray-600 mb-1">Hasta</label>
                <input
                  type="time"
                  value={timeTo}
                  onChange={(e) => setTimeTo(e.target.value)}
                  className="w-full p-2 text-xs sm:text-sm border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
                  placeholder="18:00"
                />
              </div>
            </div>
            {(timeFrom || timeTo) && (
              <button
                onClick={() => {
                  setTimeFrom('');
                  setTimeTo('');
                }}
                className="mt-2 text-xs text-amber-600 hover:text-amber-700 underline"
              >
                Limpiar horario
              </button>
            )}
          </div>

          <div className="mb-4">
            <h3 className="text-sm sm:text-base font-semibold text-gray-800 mb-2">Filtros R√°pidos</h3>
            <div className="flex flex-wrap gap-2">
              {quickFilterOptions.map(filter => (
                <button
                  key={filter.id}
                  onClick={() => {
                    setQuickFilters(prev => 
                      prev.includes(filter.id)
                        ? prev.filter(id => id !== filter.id)
                        : [...prev, filter.id]
                    );
                  }}
                  className={`px-3 py-1.5 text-xs sm:text-sm font-medium rounded-full transition-all ${
                    quickFilters.includes(filter.id)
                      ? 'bg-gradient-to-r from-yellow-300 via-amber-400 to-amber-600 text-white shadow-[0_4px_15px_rgba(212,175,55,0.5)] scale-105 border border-yellow-200/30'
                      : 'bg-white border-2 border-amber-300 text-amber-700 hover:border-amber-400'
                  }`}
                >
                  {filter.label}
                </button>
              ))}
            </div>
            {quickFilters.length > 0 && (
              <button
                onClick={() => setQuickFilters([])}
                className="mt-2 text-xs text-amber-600 hover:text-amber-700 underline"
              >
                Limpiar filtros r√°pidos
              </button>
            )}
          </div>
          <h2 className="text-lg sm:text-xl lg:text-2xl font-sf-display font-semibold text-gray-800 mb-3 sm:mb-4 lg:mb-6">Categor√≠as</h2>
          <div className="flex flex-wrap gap-2 sm:gap-3 mb-6 sm:mb-8">
            {categories.map(cat => {
              const IconComponent = cat.icon;
              return (
          <button
            key={cat.id}
            onClick={() => toggleCategory(cat.id)}
                  className={`flex items-center gap-1 sm:gap-2 px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm font-medium rounded-full transition-all duration-300 shadow-lg card-hover scale-in ${
              selectedCategories.includes(cat.id)
                      ? 'bg-gradient-to-br from-yellow-300 via-amber-400 to-amber-600 text-white shadow-[0_4px_15px_rgba(212,175,55,0.5)] glow-animation border border-yellow-200/30'
                      : 'bg-gradient-to-br from-amber-50 to-yellow-50 text-amber-800 border-2 border-amber-400/60 hover:border-amber-500/80 hover:shadow-[0_6px_18px_rgba(212,175,55,0.3)]'
            }`}
          >
                  <IconComponent className="w-3 h-3 sm:w-4 sm:h-4" />
            <span>{cat.nombre}</span>
          </button>
              );
            })}
      </div>
          <h2 className="text-lg sm:text-xl lg:text-2xl font-sf-display font-semibold text-gray-800 mb-3 sm:mb-4 lg:mb-6">Resultados</h2>
          <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
        {filteredActivities.length > 0 ? (
              filteredActivities.map(activity => {
                const category = categories.find(c => c.id === activity.category);
                const CategoryIcon = category?.icon;
                return (
                  <div 
                    key={activity.id} 
                    onClick={() => {
                      const event = new CustomEvent('showEventDetails', { detail: activity });
                      window.dispatchEvent(event);
                    }}
                    className="relative flex flex-col lg:flex-row lg:items-center p-3 sm:p-4 lg:p-5 bg-white rounded-xl shadow-xl border-2 border-amber-200 card-hover overflow-hidden scale-in group cursor-pointer"
                  >
              <img 
                src={activity.img} 
                alt={activity.title}
                      className="w-full lg:w-32 lg:h-32 h-48 lg:h-32 object-cover rounded-lg shadow-md mb-3 lg:mb-0 lg:mr-4 transform hover:scale-105 transition-transform duration-300"
                onError={(e) => e.target.src = 'https://placehold.co/100x100/eeeeee/aaaaaa?text=Img'}
              />
                    <div className="flex-grow min-w-0">
                      <div className="flex items-start justify-between mb-2">
                        <h3 className="text-base sm:text-lg lg:text-xl font-sf-text font-bold text-gray-900 flex-1">{activity.title}</h3>
                        <div className="flex items-center gap-1 ml-2">
                          {activity.featured && (
                            <span className="px-2 py-0.5 text-[10px] font-bold text-white bg-gradient-to-r from-yellow-500 to-amber-600 rounded-full">
                              ‚≠ê
                  </span>
                          )}
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              const isFav = userStateGlobal.favoritos.includes(activity.id);
                              setUserStateGlobal(prev => ({
                                ...prev,
                                favoritos: isFav 
                                  ? prev.favoritos.filter(id => id !== activity.id)
                                  : [...prev.favoritos, activity.id]
                              }));
                            }}
                            className={`p-1.5 rounded-full transition-all ${
                              userStateGlobal.favoritos.includes(activity.id)
                                ? 'bg-amber-100 text-amber-600 scale-110'
                                : 'bg-gray-100 text-gray-400 hover:bg-amber-100 hover:text-amber-600'
                            }`}
                            title={userStateGlobal.favoritos.includes(activity.id) ? 'Quitar de favoritos' : 'Agregar a favoritos'}
                          >
                            <Bookmark className="w-4 h-4" fill={userStateGlobal.favoritos.includes(activity.id) ? 'currentColor' : 'none'} />
                          </button>
                          <button
                            onClick={(e) => {
                              e.stopPropagation();
                              if (navigator.share) {
                                navigator.share({
                                  title: activity.title,
                                  text: activity.description,
                                  url: window.location.href
                                });
                              } else {
                                navigator.clipboard.writeText(`${activity.title} - ${window.location.href}`);
                                alert('¬°Enlace copiado al portapapeles!');
                              }
                            }}
                            className="p-1.5 rounded-full bg-gray-100 text-gray-400 hover:bg-blue-100 hover:text-blue-600 transition-all"
                          >
                            <Share2 className="w-4 h-4" />
                          </button>
                        </div>
                      </div>
                      <div className="flex items-center gap-2 text-xs text-gray-600 mb-2">
                        <span className="flex items-center gap-1">
                          <Star className="w-3 h-3 text-amber-500 fill-amber-500" />
                          {activity.rating} ({activity.reviews})
                        </span>
                        <span className="flex items-center gap-1">
                          <MapPin2 className="w-3 h-3" />
                          {activity.location}
                        </span>
                        <span className="flex items-center gap-1">
                          <Clock className="w-3 h-3" />
                          {activity.time}
                        </span>
                      </div>
                      <div className="flex items-center justify-between text-xs sm:text-sm flex-wrap gap-2">
                        <div className="flex items-center gap-2 flex-wrap">
                          <span className="inline-flex items-center gap-1 px-2 py-1 bg-amber-100 rounded-full">
                            {category?.emoji}
                            {category?.nombre}
                          </span>
                          <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-medium">
                            {activity.price}
                          </span>
                          {activity.available < 10 && (
                            <span className="px-2 py-1 bg-red-100 text-red-700 rounded-full font-medium">
                              ¬°√öltimos cupos!
                            </span>
                          )}
                        </div>
                        <span className="inline-flex items-center gap-1 text-amber-600 font-medium">
                          <Compass className="w-3 h-3 sm:w-4 sm:h-4" />
                    {activity.distance} km
                  </span>
                </div>
                      <div className="mt-2 flex items-center gap-2 text-xs text-gray-500">
                        <span className="flex items-center gap-1">
                          <Users2 className="w-3 h-3" />
                          {activity.registered}/{activity.capacity} inscritos
                        </span>
                        <span className="flex items-center gap-1">
                          <Calendar className="w-3 h-3" />
                          {new Date(activity.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short' })}
                        </span>
              </div>
            </div>
                  </div>
                );
              })
        ) : (
              <div className="col-span-full">
                <p className="text-center text-sm sm:text-base lg:text-lg text-gray-500 p-6 lg:p-8 bg-gray-50 rounded-xl">No se encontraron actividades con esos filtros.</p>
              </div>
        )}
      </div>
    </div>
  );
});

    // P√ÅGINA DE MAPA (FUNCIONAL CON LEAFLET)
const PageMap = memo(() => {
      const mapRef = useRef(null);
      const mapInstanceRef = useRef(null);
      const markersRef = useRef([]);
      const [selectedActivity, setSelectedActivity] = useState(null);

      useEffect(() => {
        if (!mapRef.current) return;

        // Inicializar mapa
        if (!mapInstanceRef.current) {
          mapInstanceRef.current = L.map(mapRef.current).setView([userLocation.lat, userLocation.lon], 13);
          
          // Agregar capa de tiles
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
          }).addTo(mapInstanceRef.current);

          // Marcador de usuario
          const userIcon = L.divIcon({
            className: 'custom-marker pulse-glow',
            html: '<div style="background: #f59e0b; border: 3px solid white; border-radius: 50%; width: 20px; height: 20px; box-shadow: 0 2px 8px rgba(251, 191, 36, 0.5);"></div>',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
          });
          L.marker([userLocation.lat, userLocation.lon], { icon: userIcon })
            .addTo(mapInstanceRef.current)
            .bindPopup('<b>Tu ubicaci√≥n</b>').openPopup();
        }

        // Limpiar marcadores anteriores
        markersRef.current.forEach(marker => {
          mapInstanceRef.current.removeLayer(marker);
        });
        markersRef.current = [];

        // Agregar marcadores de actividades
        mockActivities.forEach(activity => {
          const category = categories.find(c => c.id === activity.category);
          const customIcon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background: #f59e0b; border: 3px solid white; border-radius: 50%; width: 16px; height: 16px; box-shadow: 0 2px 8px rgba(251, 191, 36, 0.5);"></div>`,
            iconSize: [16, 16],
            iconAnchor: [8, 8]
          });

          const marker = L.marker([activity.lat, activity.lon], { icon: customIcon })
            .addTo(mapInstanceRef.current)
            .bindPopup(`
              <div style="min-width: 220px; max-width: 280px;">
                <div style="display: flex; align-items: start; justify-content: space-between; margin-bottom: 8px;">
                  <h3 style="font-weight: bold; margin: 0; color: #1f2937; font-size: 14px; flex: 1;">${activity.title}</h3>
                  ${activity.featured ? '<span style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold;">‚≠ê</span>' : ''}
                </div>
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 11px; color: #6b7280;">
                  <span>‚≠ê ${activity.rating} (${activity.reviews})</span>
                  <span>‚Ä¢</span>
                  <span>üìç ${activity.distance} km</span>
                </div>
                <p style="font-size: 11px; color: #9ca3af; margin-bottom: 6px; line-height: 1.4;">${activity.description.substring(0, 100)}...</p>
                <div style="display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin-bottom: 6px;">
                  <span style="background: #fef3c7; color: #92400e; padding: 2px 6px; border-radius: 8px; font-size: 10px;">${category?.emoji} ${category?.nombre}</span>
                  <span style="background: ${activity.price === 'Gratis' ? '#dbeafe' : '#fef3c7'}; color: ${activity.price === 'Gratis' ? '#1e40af' : '#92400e'}; padding: 2px 6px; border-radius: 8px; font-size: 10px; font-weight: 600;">${activity.price}</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 10px; color: #6b7280;">
                  <span>üìÖ ${new Date(activity.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short' })}</span>
                  <span>üïê ${activity.time}</span>
                  <span>üë• ${activity.available} cupos</span>
                </div>
              </div>
            `);

          marker.on('click', () => {
            setSelectedActivity(activity);
          });

          markersRef.current.push(marker);
        });

        return () => {
          // Cleanup se maneja en el siguiente render
        };
      }, []);

  return (
        <div className="p-4 sm:p-5 lg:p-8 h-full flex flex-col bg-white font-sf-text">
          <div className="mb-4 sm:mb-6">
            <h1 className="text-2xl sm:text-3xl lg:text-4xl font-sf-display font-bold text-gold-gradient mb-2 slide-in">
              Mapa de Actividades
            </h1>
            <p className="text-sm sm:text-base lg:text-lg text-gray-600">Explora eventos y lugares cercanos a ti.</p>
          </div>
          
          <div className="flex-grow relative w-full map-container">
            <div ref={mapRef} style={{ width: '100%', height: '100%', borderRadius: '1rem' }}></div>
          </div>

          {selectedActivity && (
            <div className="mt-4 p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-xl border-2 border-amber-200 card-hover scale-in">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <h3 className="text-lg font-bold text-gray-900 mb-1">{selectedActivity.title}</h3>
                  <p className="text-sm text-gray-600 mb-2">{selectedActivity.description}</p>
                  <div className="flex items-center gap-4 text-xs text-gray-500">
                    <span className="flex items-center gap-1">
                      <Compass className="w-4 h-4" />
                      {selectedActivity.distance} km
                    </span>
                    <span className="flex items-center gap-1">
                      <Calendar className="w-4 h-4" />
                      {new Date(selectedActivity.date).toLocaleDateString('es-PE')}
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => setSelectedActivity(null)}
                  className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>
          )}
        </div>
      );
    });

    // P√ÅGINA DE PERFIL/USUARIO
    const PageProfile = memo(({ setSubView }) => {
      const [activeTab, setActiveTab] = useState('inscripciones');
      const [userState, setUserState] = useState(userStateGlobal);
      const [showOnboarding, setShowOnboarding] = useState(false);
      
      useEffect(() => {
        const handleUpdate = (e) => {
          setUserState(e.detail);
        };
        window.addEventListener('userStateUpdated', handleUpdate);
        return () => window.removeEventListener('userStateUpdated', handleUpdate);
      }, []);

      const handleToggleFavorite = (activityId) => {
        setUserStateGlobal(prev => ({
          ...prev,
          favoritos: prev.favoritos.includes(activityId)
            ? prev.favoritos.filter(id => id !== activityId)
            : [...prev.favoritos, activityId]
        }));
      };

      const handleUpdatePreferences = () => {
        setShowOnboarding(true);
      };

      const handleOnboardingComplete = () => {
        setShowOnboarding(false);
        loadPreferences();
        setUserState(userStateGlobal);
      };

      if (showOnboarding) {
        return <OnboardingScreen onComplete={handleOnboardingComplete} />;
      }
          
          return (
        <div className="p-4 sm:p-5 lg:p-8 bg-white font-sf-text h-full overflow-y-auto">
          <div className="flex items-center justify-between mb-6 lg:mb-8">
            <div className="flex items-center gap-4 lg:gap-6">
              <div className="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                <User className="w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 text-white" />
              </div>
              <div>
                <h1 className="text-xl sm:text-2xl lg:text-3xl font-sf-display font-bold text-gray-900 mb-1">Mi Perfil</h1>
                <p className="text-sm sm:text-base lg:text-lg text-gray-600">Plan: {userState.plan.charAt(0).toUpperCase() + userState.plan.slice(1)}</p>
                {userState.preferences && (
                  <p className="text-xs text-gray-500 mt-1">
                    {userState.gustos.length} gustos ‚Ä¢ {userState.estadoAnimico ? 'Estado: ' + userState.estadoAnimico : 'Sin estado'}
                  </p>
                )}
              </div>
            </div>
            <button
              onClick={handleUpdatePreferences}
              className="px-4 py-2 text-sm font-medium text-amber-700 bg-amber-50 border-2 border-amber-300 rounded-lg hover:bg-amber-100 transition-all"
              title="Actualizar preferencias"
            >
              <Settings className="w-5 h-5" />
            </button>
              </div>
              
          <div className="flex gap-2 mb-6 border-b border-gray-200">
            <button
              onClick={() => setActiveTab('inscripciones')}
              className={`px-4 py-2 text-sm sm:text-base font-medium transition-colors ${
                activeTab === 'inscripciones'
                  ? 'text-amber-600 border-b-2 border-amber-600'
                  : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              Mis Inscripciones ({userState.inscripciones.length})
            </button>
            <button
              onClick={() => setActiveTab('organizados')}
              className={`px-4 py-2 text-sm sm:text-base font-medium transition-colors ${
                activeTab === 'organizados'
                  ? 'text-amber-600 border-b-2 border-amber-600'
                  : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              Eventos Organizados ({userState.eventosOrganizados.length})
            </button>
            <button
              onClick={() => setActiveTab('favoritos')}
              className={`px-4 py-2 text-sm sm:text-base font-medium transition-colors ${
                activeTab === 'favoritos'
                  ? 'text-amber-600 border-b-2 border-amber-600'
                  : 'text-gray-600 hover:text-gray-900'
              }`}
            >
              Favoritos ({userState.favoritos.length})
            </button>
          </div>

          {activeTab === 'inscripciones' && (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
              {userState.inscripciones.length > 0 ? (
                userState.inscripciones.map(activity => {
                  const category = categories.find(c => c.id === activity.category);
                  return (
                    <div key={activity.id} className="flex flex-col lg:flex-row lg:items-center p-3 sm:p-4 lg:p-5 bg-white rounded-xl shadow-lg border-2 border-amber-200 hover:shadow-xl transition-all card-hover">
                      <img 
                        src={activity.img} 
                        alt={activity.title}
                        className="w-full lg:w-24 lg:h-24 h-40 lg:h-24 object-cover rounded-lg shadow-md mb-3 lg:mb-0 lg:mr-4"
                        onError={(e) => e.target.src = 'https://placehold.co/100x100/eeeeee/aaaaaa?text=Img'}
                      />
                      <div className="flex-grow min-w-0">
                        <h3 className="text-base sm:text-lg lg:text-xl font-sf-text font-bold text-gray-900 mb-2">{activity.title}</h3>
                        <div className="flex items-center gap-3 text-xs sm:text-sm text-gray-600 flex-wrap">
                          <span className="flex items-center gap-1">
                            <Calendar className="w-3 h-3 sm:w-4 sm:h-4 text-amber-600" />
                            {new Date(activity.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short', year: 'numeric' })}
                          </span>
                          {activity.time && (
                            <span className="flex items-center gap-1">
                              <Clock className="w-3 h-3 sm:w-4 sm:h-4 text-amber-600" />
                              {activity.time}
                            </span>
                          )}
                          {activity.location && (
                            <span className="flex items-center gap-1">
                              <MapPin2 className="w-3 h-3 sm:w-4 sm:h-4 text-amber-600" />
                              {activity.location}
                            </span>
                          )}
                        </div>
                      </div>
                      <button 
                        onClick={() => {
                          setUserStateGlobal(prev => ({
                            ...prev,
                            inscripciones: prev.inscripciones.filter(a => a.id !== activity.id)
                          }));
                        }}
                        className="mt-3 lg:mt-0 lg:ml-2 p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors self-start lg:self-center"
                      >
                        <Trash className="w-4 h-4 sm:w-5 sm:h-5" />
                      </button>
            </div>
          );
                })
              ) : (
                <div className="col-span-full text-center py-12 lg:py-16">
                  <Calendar className="w-16 h-16 lg:w-20 lg:h-20 mx-auto text-gray-300 mb-4" />
                  <p className="text-gray-500 text-base lg:text-lg">No tienes inscripciones a√∫n</p>
      </div>
              )}
            </div>
          )}

          {activeTab === 'favoritos' && (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
              {userState.favoritos.length > 0 ? (
                mockActivities.filter(a => userState.favoritos.includes(a.id)).map(activity => {
                  const category = categories.find(c => c.id === activity.category);
                  return (
                    <div key={activity.id} className="flex flex-col lg:flex-row lg:items-center p-3 sm:p-4 lg:p-5 bg-white rounded-xl shadow-lg border-2 border-amber-200 hover:shadow-xl transition-all card-hover">
                      <img 
                        src={activity.img} 
                        alt={activity.title}
                        className="w-full lg:w-24 lg:h-24 h-40 lg:h-24 object-cover rounded-lg shadow-md mb-3 lg:mb-0 lg:mr-4"
                        onError={(e) => e.target.src = 'https://placehold.co/100x100/eeeeee/aaaaaa?text=Img'}
                      />
                      <div className="flex-grow min-w-0">
                        <div className="flex items-start justify-between mb-2">
                          <h3 className="text-base sm:text-lg lg:text-xl font-sf-text font-bold text-gray-900 flex-1">{activity.title}</h3>
                          <button
                            onClick={() => {
                              handleToggleFavorite(activity.id);
                            }}
                            className="p-1.5 rounded-full bg-amber-100 text-amber-600 hover:bg-amber-200 transition-colors"
                            title="Quitar de favoritos"
                          >
                            <Bookmark className="w-4 h-4" fill="currentColor" />
                          </button>
                        </div>
                        <div className="flex items-center gap-2 text-xs text-gray-600 mb-2">
                          <span className="flex items-center gap-1">
                            <Star className="w-3 h-3 text-amber-500 fill-amber-500" />
                            {activity.rating}
                          </span>
                          <span className="flex items-center gap-1">
                            <MapPin2 className="w-3 h-3" />
                            {activity.location}
                          </span>
                        </div>
                        <div className="flex items-center gap-2 text-xs text-gray-500">
                          <span className="flex items-center gap-1">
                            <Calendar className="w-3 h-3" />
                            {new Date(activity.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short' })}
                          </span>
                          <span className="px-2 py-0.5 bg-amber-100 text-amber-700 rounded-full font-medium">
                            {activity.price}
                          </span>
                        </div>
                      </div>
                    </div>
                  );
                })
              ) : (
                <div className="col-span-full text-center py-12 lg:py-16">
                  <Bookmark className="w-16 h-16 lg:w-20 lg:h-20 mx-auto text-gray-300 mb-4" />
                  <p className="text-gray-500 text-base lg:text-lg">No tienes eventos favoritos a√∫n</p>
                </div>
              )}
            </div>
          )}

          {activeTab === 'organizados' && (
            <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6">
              {userState.eventosOrganizados.length > 0 ? (
                userState.eventosOrganizados.map(evento => (
                  <div key={evento.id} className="p-4 sm:p-5 lg:p-6 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
                    <div className="flex items-start justify-between mb-3">
                      <h3 className="text-base sm:text-lg lg:text-xl font-semibold text-gray-900 flex-grow pr-2">{evento.title}</h3>
                      <div className="flex gap-2 flex-shrink-0">
                        <button className="p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors">
                          <Edit className="w-4 h-4 sm:w-5 sm:h-5" />
                        </button>
                        <button className="p-1.5 text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                          <Trash className="w-4 h-4 sm:w-5 sm:h-5" />
                        </button>
                      </div>
                    </div>
                    <div className="flex items-center gap-4 text-xs sm:text-sm lg:text-base text-gray-500">
                      <span className="flex items-center gap-1">
                        <Calendar className="w-3 h-3 sm:w-4 sm:h-4" />
                        {new Date(evento.date).toLocaleDateString('es-PE')}
                      </span>
                      <span className="flex items-center gap-1">
                        <Users className="w-3 h-3 sm:w-4 sm:h-4" />
                        {evento.inscritos || 0} inscritos
                      </span>
                    </div>
                  </div>
                ))
              ) : (
                <div className="col-span-full text-center py-12 lg:py-16">
                  <Plus className="w-16 h-16 lg:w-20 lg:h-20 mx-auto text-gray-300 mb-4" />
                  <p className="text-gray-500 mb-4 text-base lg:text-lg">No has organizado eventos a√∫n</p>
                  <button className="px-6 py-3 lg:px-8 lg:py-4 bg-gradient-to-br from-yellow-300 via-amber-400 to-amber-600 text-white rounded-full font-medium shadow-[0_4px_15px_rgba(212,175,55,0.5)] hover:shadow-[0_6px_25px_rgba(212,175,55,0.6)] transition-all text-sm sm:text-base border border-yellow-200/30">
                    Crear Evento
                  </button>
                </div>
              )}
            </div>
          )}
    </div>
  );
});

    // P√ÅGINA DE SUSCRIPCIONES
    const PageSubscriptions = memo(() => {
      const [userStateSub, setUserStateSub] = useState(userStateGlobal);
      
      useEffect(() => {
        const handleUpdate = (e) => {
          setUserStateSub(e.detail);
        };
        window.addEventListener('userStateUpdated', handleUpdate);
        return () => window.removeEventListener('userStateUpdated', handleUpdate);
      }, []);
      const plans = [
        {
          id: 'gratuito',
          name: 'Gratuito',
          price: '0.00',
          period: 'Siempre',
          features: [
            'Acceso b√°sico a actividades',
            'Hasta 10 recomendaciones diarias',
            'B√∫squeda y filtros b√°sicos',
            'Mapa de actividades',
            'Inscripci√≥n a eventos',
            '1 mes gratis (ya incluido)'
          ],
          popular: false,
          color: 'gray'
        },
        {
          id: 'personal',
          name: 'Personal',
          price: '19.90',
          period: 'mes',
          features: [
            'Todo del plan Gratuito',
            'Generaci√≥n de recuerdos por cada experiencia vivida',
            'Sin anuncios',
            'Sin l√≠mite de recomendaciones',
            'Acceso a promociones especiales',
            '1 mes gratis'
          ],
          popular: true,
          color: 'yellow'
        },
        {
          id: 'empresa',
          name: 'Empresa',
          price: '49.90',
          period: 'mes',
          features: [
            'Todo del plan Personal',
            'Destaca en las recomendaciones',
            'Primera fila en b√∫squedas',
            'Capacidad de publicar promociones',
            'Llega a m√°s gente',
            'Dashboard en tiempo real para ver interacciones por anuncio',
            '1 mes gratis'
          ],
          popular: false,
          color: 'blue'
        }
      ];

      const [userState, setUserState] = useState(userStateGlobal);
      
      useEffect(() => {
        const handleUpdate = (e) => {
          setUserState(e.detail);
        };
        window.addEventListener('userStateUpdated', handleUpdate);
        return () => window.removeEventListener('userStateUpdated', handleUpdate);
      }, []);

      const handleSelectPlan = (planId) => {
        setUserStateGlobal(prev => ({ ...prev, plan: planId }));
        alert(`¬°Plan ${planId} seleccionado! Disfruta de tu mes gratis.`);
      };

      return (
        <div className="p-4 sm:p-5 lg:p-8 bg-white font-sf-text h-full overflow-y-auto">
          <h1 className="text-2xl sm:text-3xl lg:text-4xl font-sf-display font-bold text-gray-900 mb-2 lg:mb-4">Planes de Suscripci√≥n</h1>
          <p className="text-sm sm:text-base lg:text-lg text-gray-600 mb-6 lg:mb-8">Todos los planes incluyen 1 mes gratis</p>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
            {plans.map(plan => (
              <div
                key={plan.id}
                className={`relative p-5 sm:p-6 rounded-2xl border-2 transition-all ${
                  plan.popular
                    ? 'border-yellow-400 shadow-xl scale-105'
                    : 'border-gray-200 hover:border-gray-300'
                    } ${
                  userStateSub.plan === plan.id ? 'ring-2 ring-yellow-400' : ''
                }`}
              >
                {plan.popular && (
                  <div className="absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 bg-gradient-to-br from-yellow-400 to-yellow-600 text-white text-xs font-semibold rounded-full">
                    M√°s Popular
                  </div>
                )}
                {userStateSub.plan === plan.id && (
                  <div className="absolute top-4 right-4">
                    <Check className="w-6 h-6 text-green-500" fill="currentColor" />
                  </div>
                )}

                <div className="text-center mb-6">
                  <h3 className="text-xl sm:text-2xl font-bold text-gray-900 mb-2">{plan.name}</h3>
                  <div className="flex items-baseline justify-center gap-1">
                    <span className="text-3xl sm:text-4xl font-bold text-gray-900">S/.</span>
                    <span className="text-3xl sm:text-4xl font-bold text-gray-900">{plan.price}</span>
                    {plan.period !== 'Siempre' && (
                      <span className="text-sm sm:text-base text-gray-500">/{plan.period}</span>
                    )}
                  </div>
                </div>

                <ul className="space-y-3 mb-6">
                  {plan.features.map((feature, idx) => (
                    <li key={idx} className="flex items-start gap-2 text-sm sm:text-base text-gray-700">
                      <Check className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                      <span>{feature}</span>
                    </li>
                  ))}
                </ul>

                <button
                  onClick={() => handleSelectPlan(plan.id)}
                  className={`w-full py-3 px-4 rounded-xl font-semibold transition-all ${
                    plan.popular
                      ? 'bg-gradient-to-br from-yellow-400 to-yellow-600 text-white hover:from-yellow-500 hover:to-yellow-700'
                      : plan.id === 'gratuito'
                      ? 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      : 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                  } ${
                    userStateSub.plan === plan.id ? 'opacity-50 cursor-not-allowed' : ''
                  }`}
                  disabled={userStateSub.plan === plan.id}
                >
                  {userStateSub.plan === plan.id ? 'Plan Actual' : plan.id === 'gratuito' ? 'Plan Actual' : 'Seleccionar Plan'}
                </button>
              </div>
            ))}
          </div>
        </div>
      );
    });

    // P√ÅGINA PARA ORGANIZAR EVENTOS
    const PageOrganize = memo(() => {
      const [formData, setFormData] = useState({
        title: '',
        category: '',
        description: '',
        date: '',
        location: '',
        price: '',
        img: ''
      });

      const handleSubmit = (e) => {
        e.preventDefault();
        const newEvent = {
          id: Date.now(),
          ...formData,
          lat: userLocation.lat + (Math.random() - 0.5) * 0.01,
          lon: userLocation.lon + (Math.random() - 0.5) * 0.01,
          distance: 0,
          organizer: 'T√∫',
          inscritos: 0
        };
        setUserStateGlobal(prev => ({
          ...prev,
          eventosOrganizados: [...prev.eventosOrganizados, newEvent]
        }));
        mockActivities.push(newEvent);
        alert('¬°Evento creado exitosamente!');
        setFormData({
          title: '',
          category: '',
          description: '',
          date: '',
          location: '',
          price: '',
          img: ''
        });
      };

      return (
        <div className="p-4 sm:p-5 lg:p-8 bg-white font-sf-text h-full overflow-y-auto max-w-4xl mx-auto">
          <h1 className="text-2xl sm:text-3xl lg:text-4xl font-sf-display font-bold text-gray-900 mb-4 sm:mb-6 lg:mb-8">Organizar Evento</h1>
          
          <form onSubmit={handleSubmit} className="space-y-4 sm:space-y-6 lg:space-y-8">
            <div>
              <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">T√≠tulo del Evento</label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={(e) => setFormData({...formData, title: e.target.value})}
                className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
                placeholder="Ej: Torneo de F√∫tbol"
              />
            </div>

            <div>
              <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">Categor√≠a</label>
              <select
                required
                value={formData.category}
                onChange={(e) => setFormData({...formData, category: e.target.value})}
                className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
              >
                <option value="">Selecciona una categor√≠a</option>
                {categories.map(cat => (
                  <option key={cat.id} value={cat.id}>{cat.emoji} {cat.nombre}</option>
                ))}
              </select>
            </div>

            <div>
              <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">Descripci√≥n</label>
              <textarea
                required
                value={formData.description}
                onChange={(e) => setFormData({...formData, description: e.target.value})}
                rows="4"
                className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
                placeholder="Describe tu evento..."
              />
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6">
              <div>
                <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">Fecha</label>
                <input
                  type="date"
                  required
                  value={formData.date}
                  onChange={(e) => setFormData({...formData, date: e.target.value})}
                  className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
                />
              </div>

              <div>
                <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">Precio</label>
                <input
                  type="text"
                  value={formData.price}
                  onChange={(e) => setFormData({...formData, price: e.target.value})}
                  className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
                  placeholder="Ej: S/.25.00 o Gratis"
                />
              </div>
            </div>

            <div>
              <label className="block text-sm sm:text-base font-medium text-gray-700 mb-2">URL de Imagen</label>
              <input
                type="url"
                value={formData.img}
                onChange={(e) => setFormData({...formData, img: e.target.value})}
                className="w-full p-3 sm:p-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-yellow-400"
                placeholder="https://ejemplo.com/imagen.jpg"
              />
            </div>

            <button
              type="submit"
              className="w-full py-3 sm:py-4 bg-gradient-to-br from-yellow-400 to-yellow-600 text-white rounded-xl font-semibold hover:from-yellow-500 hover:to-yellow-700 transition-all"
            >
              Crear Evento
            </button>
          </form>
        </div>
      );
    });

    // NAVEGACI√ìN
const NavBar = memo(({ view, setView }) => {
  const navItems = [
    { id: 'home', icon: Home, label: 'Inicio' },
    { id: 'swipe', icon: LayoutGrid, label: 'Explorar' },
    { id: 'filters', icon: Filter, label: 'Buscar' },
    { id: 'map', icon: MapPin, label: 'Mapa' },
        { id: 'profile', icon: User, label: 'Perfil' },
  ];

  return (
        <nav className="sticky bottom-0 w-full bg-gradient-to-t from-amber-50 via-yellow-50 to-amber-50 border-t-2 border-amber-400/40 shadow-[0_-8px_30px_rgba(212,175,55,0.3)] z-50 backdrop-blur-sm">
          <div className="flex justify-around mx-auto py-2 sm:py-2">
        {navItems.map(item => {
          const isActive = view === item.id;
          const IconComponent = item.icon;
          return (
            <button
              key={item.id}
              onClick={() => setView(item.id)}
                  className={`flex flex-col items-center justify-center w-16 sm:w-20 py-1 sm:py-1.5 rounded-lg transition-all duration-300 ${
                isActive 
                  ? 'text-amber-700 scale-110 drop-shadow-sm' 
                  : 'text-gray-500 hover:text-amber-600'
              }`}
            >
              <div className={`relative ${isActive ? 'glow-animation' : ''}`}>
              <IconComponent 
                  className={`w-5 h-5 sm:w-6 sm:h-6 transition-all ${isActive ? 'scale-110' : ''}`} 
                strokeWidth={isActive ? 2.5 : 2}
              />
                {isActive && (
                  <div className="absolute -inset-1 bg-gradient-to-r from-yellow-300 to-amber-400 rounded-full opacity-60 blur-sm shadow-[0_0_15px_rgba(212,175,55,0.5)]"></div>
                )}
              </div>
              <span className={`mt-0.5 sm:mt-1 text-[10px] sm:text-xs font-sf-text font-medium transition-all ${isActive ? 'font-bold text-amber-600' : ''}`}>{item.label}</span>
            </button>
          );
        })}
      </div>
    </nav>
  );
});

    // MODAL DE DETALLES DEL EVENTO
    const EventDetailsModal = memo(({ event, onClose }) => {
      const [userState, setUserState] = useState(userStateGlobal);
      
      useEffect(() => {
        const handleUpdate = (e) => {
          setUserState(e.detail);
        };
        window.addEventListener('userStateUpdated', handleUpdate);
        return () => window.removeEventListener('userStateUpdated', handleUpdate);
      }, []);

      if (!event) return null;
      const category = categories.find(c => c.id === event.category);
      const isFavorite = userState.favoritos.includes(event.id);
      const isRegistered = userState.inscripciones.some(a => a.id === event.id);

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onClick={onClose}>
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onClick={(e) => e.stopPropagation()}>
            <div className="relative">
              <img 
                src={event.img} 
                alt={event.title}
                className="w-full h-64 object-cover"
                onError={(e) => e.target.src = 'https://placehold.co/800x400/dddddd/666666?text=Imagen+No+Disponible'}
              />
              <button
                onClick={onClose}
                className="absolute top-4 right-4 p-2 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors"
              >
                <X className="w-5 h-5" />
              </button>
              {event.featured && (
                <span className="absolute top-4 left-4 px-3 py-1 bg-gradient-to-r from-yellow-500 to-amber-600 text-white text-xs font-bold rounded-full">
                  ‚≠ê DESTACADO
                </span>
              )}
            </div>
            <div className="p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h2 className="text-2xl sm:text-3xl font-bold text-gold-gradient mb-2">{event.title}</h2>
                  <div className="flex items-center gap-3 text-sm text-gray-600 mb-3">
                    <span className="flex items-center gap-1">
                      <Star className="w-4 h-4 text-amber-500 fill-amber-500" />
                      {event.rating} ({event.reviews} rese√±as)
                    </span>
                    <span className="flex items-center gap-1">
                      <MapPin2 className="w-4 h-4" />
                      {event.location}
                    </span>
                  </div>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={() => {
                      setUserStateGlobal(prev => ({
                        ...prev,
                        favoritos: isFavorite
                          ? prev.favoritos.filter(id => id !== event.id)
                          : [...prev.favoritos, event.id]
                      }));
                    }}
                    className={`p-2 rounded-full transition-all ${
                      isFavorite ? 'bg-amber-100 text-amber-600' : 'bg-gray-100 text-gray-400 hover:bg-amber-100 hover:text-amber-600'
                    }`}
                  >
                    <Bookmark className="w-5 h-5" fill={isFavorite ? 'currentColor' : 'none'} />
                  </button>
                  <button
                    onClick={() => {
                      if (navigator.share) {
                        navigator.share({
                          title: event.title,
                          text: event.description,
                          url: window.location.href
                        });
                      } else {
                        navigator.clipboard.writeText(`${event.title} - ${window.location.href}`);
                        alert('¬°Enlace copiado!');
                      }
                    }}
                    className="p-2 rounded-full bg-gray-100 text-gray-400 hover:bg-blue-100 hover:text-blue-600 transition-all"
                  >
                    <Share2 className="w-5 h-5" />
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4 p-4 bg-amber-50 rounded-xl">
                <div>
                  <div className="text-xs text-gray-600 mb-1">Fecha</div>
                  <div className="text-sm font-semibold text-gray-900 flex items-center gap-1">
                    <Calendar className="w-4 h-4 text-amber-600" />
                    {new Date(event.date).toLocaleDateString('es-PE', { day: 'numeric', month: 'short', year: 'numeric' })}
                  </div>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">Hora</div>
                  <div className="text-sm font-semibold text-gray-900 flex items-center gap-1">
                    <Clock className="w-4 h-4 text-amber-600" />
                    {event.time}
                  </div>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">Precio</div>
                  <div className="text-sm font-semibold text-gray-900">{event.price}</div>
                </div>
                <div>
                  <div className="text-xs text-gray-600 mb-1">Cupos</div>
                  <div className="text-sm font-semibold text-gray-900 flex items-center gap-1">
                    <Users2 className="w-4 h-4 text-amber-600" />
                    {event.available} disponibles
                  </div>
                </div>
              </div>

              <div className="mb-4">
                <h3 className="text-lg font-semibold text-gray-900 mb-2">Descripci√≥n</h3>
                <p className="text-gray-700 leading-relaxed">{event.description}</p>
              </div>

              <div className="flex flex-wrap gap-2 mb-4">
                <span className="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-medium">
                  {category?.emoji} {category?.nombre}
                </span>
                <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                  üìç {event.distance} km de distancia
                </span>
                <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                  üë§ {event.organizer}
                </span>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    if (!isRegistered) {
                      setUserStateGlobal(prev => ({
                        ...prev,
                        inscripciones: [...prev.inscripciones, event]
                      }));
                      alert('¬°Te has inscrito exitosamente!');
                      onClose();
                    } else {
                      alert('Ya est√°s inscrito en este evento');
                    }
                  }}
                  disabled={isRegistered || event.available === 0}
                  className={`flex-1 py-3 px-6 rounded-xl font-semibold transition-all ${
                    isRegistered
                      ? 'bg-gray-200 text-gray-500 cursor-not-allowed'
                      : event.available === 0
                      ? 'bg-red-200 text-red-500 cursor-not-allowed'
                      : 'bg-gradient-to-br from-yellow-300 via-amber-400 to-amber-600 text-white shadow-[0_4px_15px_rgba(212,175,55,0.5)] hover:shadow-[0_6px_25px_rgba(212,175,55,0.6)] transform hover:scale-105 border border-yellow-200/30'
                  }`}
                >
                  {isRegistered ? 'Ya Inscrito' : event.available === 0 ? 'Sin Cupos' : 'Inscribirme'}
                </button>
                <button
                  onClick={onClose}
                  className="px-6 py-3 border-2 border-amber-300 text-amber-700 rounded-xl font-semibold hover:bg-amber-50 transition-all"
                >
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    });

    // COMPONENTE DE ONBOARDING
    const OnboardingScreen = memo(({ onComplete }) => {
      const [step, setStep] = useState(1);
      const [selectedGustos, setSelectedGustos] = useState([]);
      const [estadoAnimico, setEstadoAnimico] = useState(null);

      const gustosOptions = [
        { id: 'deportes', label: '‚öΩ Deportes', icon: '‚öΩ' },
        { id: 'arte', label: 'üé® Arte y Cultura', icon: 'üé®' },
        { id: 'musica', label: 'üéµ M√∫sica', icon: 'üéµ' },
        { id: 'gastronomia', label: 'üçΩÔ∏è Gastronom√≠a', icon: 'üçΩÔ∏è' },
        { id: 'naturaleza', label: 'üå≤ Naturaleza', icon: 'üå≤' },
        { id: 'tecnologia', label: 'üíª Tecnolog√≠a', icon: 'üíª' },
        { id: 'aventura', label: 'üèîÔ∏è Aventura', icon: 'üèîÔ∏è' },
        { id: 'relax', label: 'üßò Bienestar', icon: 'üßò' },
        { id: 'social', label: 'üë• Social', icon: 'üë•' },
        { id: 'educacion', label: 'üìö Educaci√≥n', icon: 'üìö' },
        { id: 'cine', label: 'üé¨ Cine', icon: 'üé¨' },
        { id: 'gaming', label: 'üéÆ Gaming', icon: 'üéÆ' }
      ];

      const estadosAnimicos = [
        { id: 'energico', label: '‚ö° En√©rgico', desc: 'Quiero algo activo y emocionante', color: 'from-yellow-400 to-orange-500' },
        { id: 'tranquilo', label: 'üòå Tranquilo', desc: 'Prefiero algo relajante y calmado', color: 'from-blue-400 to-cyan-500' },
        { id: 'social', label: 'üéâ Social', desc: 'Quiero conocer gente nueva', color: 'from-pink-400 to-rose-500' },
        { id: 'curioso', label: 'üîç Curioso', desc: 'Quiero aprender algo nuevo', color: 'from-purple-400 to-indigo-500' },
        { id: 'romantico', label: 'üíï Rom√°ntico', desc: 'Buscando algo especial para dos', color: 'from-red-400 to-pink-500' },
        { id: 'aventurero', label: 'üèîÔ∏è Aventurero', desc: 'Quiero algo fuera de lo com√∫n', color: 'from-green-400 to-emerald-500' },
        { id: 'feliz', label: 'üòä Feliz', desc: 'Quiero celebrar y disfrutar', color: 'from-yellow-300 to-amber-400' },
        { id: 'creativo', label: 'üé® Creativo', desc: 'Busco inspiraci√≥n art√≠stica', color: 'from-purple-300 to-pink-400' },
        { id: 'motivado', label: 'üöÄ Motivado', desc: 'Listo para alcanzar metas', color: 'from-blue-300 to-cyan-400' },
        { id: 'relajado', label: 'üåä Relajado', desc: 'Necesito paz y tranquilidad', color: 'from-teal-300 to-green-400' },
        { id: 'emocionado', label: 'üéä Emocionado', desc: '¬°Estoy listo para la diversi√≥n!', color: 'from-orange-300 to-pink-400' },
        { id: 'nost√°lgico', label: 'üåô Nost√°lgico', desc: 'Buscando recuerdos y tradiciones', color: 'from-indigo-300 to-blue-400' },
        { id: 'inspirado', label: 'üí° Inspirado', desc: 'Tengo ideas y quiero explorarlas', color: 'from-amber-300 to-yellow-400' }
      ];

      const toggleGusto = (gustoId) => {
        setSelectedGustos(prev =>
          prev.includes(gustoId)
            ? prev.filter(id => id !== gustoId)
            : [...prev, gustoId]
        );
      };

      const handleComplete = () => {
        const preferences = {
          gustos: selectedGustos,
          estadoAnimico: estadoAnimico
        };
        
        setUserStateGlobal(prev => ({
          ...prev,
          preferences: preferences,
          gustos: selectedGustos,
          estadoAnimico: estadoAnimico
        }));
        
        savePreferences({
          preferences: preferences,
          gustos: selectedGustos,
          estadoAnimico: estadoAnimico
        });
        
        onComplete();
      };

      return (
        <div className="fixed inset-0 bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 z-50 overflow-y-auto">
          <div className="min-h-screen flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8">
            <div className="w-full max-w-2xl">
              {/* Indicador de progreso */}
              <div className="mb-6">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-600">Paso {step} de 2</span>
                  <span className="text-sm font-medium text-gray-600">{Math.round((step / 2) * 100)}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-gradient-to-r from-yellow-400 to-amber-500 h-2 rounded-full transition-all duration-300"
                    style={{ width: `${(step / 2) * 100}%` }}
                  ></div>
                </div>
              </div>

              {/* Paso 1: Gustos */}
              {step === 1 && (
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 lg:p-10 scale-in">
                  <div className="text-center mb-6">
                    <img src="logo.png" alt="Eventum" className="w-24 h-24 rounded-2xl object-cover mx-auto mb-4" />
                    <h2 className="text-2xl sm:text-3xl font-bold text-gold-gradient mb-2">
                      ¬øQu√© te gusta hacer?
                    </h2>
                    <p className="text-gray-600 text-sm sm:text-base">
                      Selecciona tus intereses para personalizar tus recomendaciones
                    </p>
                  </div>

                  <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mb-6">
                    {gustosOptions.map(gusto => (
                      <button
                        key={gusto.id}
                        onClick={() => toggleGusto(gusto.id)}
                        className={`p-4 rounded-xl border-2 transition-all transform hover:scale-105 ${
                          selectedGustos.includes(gusto.id)
                            ? 'border-amber-500 bg-gradient-to-br from-yellow-100 to-amber-100 shadow-lg scale-105'
                            : 'border-gray-200 bg-white hover:border-amber-300'
                        }`}
                      >
                        <div className="text-3xl mb-2">{gusto.icon}</div>
                        <div className={`text-xs font-medium ${
                          selectedGustos.includes(gusto.id) ? 'text-amber-700' : 'text-gray-600'
                        }`}>
                          {gusto.label.split(' ')[1] || gusto.label}
                        </div>
                      </button>
                    ))}
                  </div>

                  <div className="flex justify-end">
                    <button
                      onClick={() => setStep(2)}
                      disabled={selectedGustos.length === 0}
                      className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                        selectedGustos.length === 0
                          ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                          : 'bg-gradient-to-br from-yellow-400 to-amber-500 text-white hover:shadow-xl transform hover:scale-105'
                      }`}
                    >
                      Continuar
                      <ChevronRight className="w-5 h-5 inline-block ml-2" />
                    </button>
                  </div>
                </div>
              )}

              {/* Paso 2: Estado An√≠mico */}
              {step === 2 && (
                <div className="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 lg:p-10 scale-in">
                  <div className="text-center mb-6">
                    <div className="inline-block p-4 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-full mb-4">
                      <Heart className="w-8 h-8 text-white" />
                    </div>
                    <h2 className="text-2xl sm:text-3xl font-bold text-gold-gradient mb-2">
                      ¬øC√≥mo te sientes hoy?
                    </h2>
                    <p className="text-gray-600 text-sm sm:text-base">
                      Esto nos ayuda a recomendarte actividades perfectas para tu estado de √°nimo
                    </p>
                  </div>

                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    {estadosAnimicos.map(estado => (
                      <button
                        key={estado.id}
                        onClick={() => setEstadoAnimico(estado.id)}
                        className={`p-6 rounded-xl border-2 transition-all transform hover:scale-105 text-left ${
                          estadoAnimico === estado.id
                            ? `border-amber-500 bg-gradient-to-br ${estado.color} text-white shadow-lg scale-105`
                            : 'border-gray-200 bg-white hover:border-amber-300 text-gray-700'
                        }`}
                      >
                        <div className="text-3xl mb-2">{estado.label.split(' ')[0]}</div>
                        <div className={`font-semibold mb-1 ${
                          estadoAnimico === estado.id ? 'text-white' : 'text-gray-800'
                        }`}>
                          {estado.label}
                        </div>
                        <div className={`text-sm ${
                          estadoAnimico === estado.id ? 'text-white/90' : 'text-gray-600'
                        }`}>
                          {estado.desc}
                        </div>
                      </button>
                    ))}
                  </div>

                  <div className="flex justify-between">
                    <button
                      onClick={() => setStep(1)}
                      className="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all"
                    >
                      <ChevronLeft className="w-5 h-5 inline-block mr-2" />
                      Atr√°s
                    </button>
                    <button
                      onClick={handleComplete}
                      disabled={!estadoAnimico}
                      className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                        !estadoAnimico
                          ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                          : 'bg-gradient-to-br from-yellow-400 to-amber-500 text-white hover:shadow-xl transform hover:scale-105'
                      }`}
                    >
                      Completar
                      <Check className="w-5 h-5 inline-block ml-2" />
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    });

    // APLICACI√ìN PRINCIPAL
    function App() {
      const [view, setView] = useState('home');
      const [subView, setSubView] = useState(null);
      const [selectedEvent, setSelectedEvent] = useState(null);
      const [showOnboarding, setShowOnboarding] = useState(!userStateGlobal.preferences);

      useEffect(() => {
        const handleShowDetails = (e) => {
          setSelectedEvent(e.detail);
        };
        window.addEventListener('showEventDetails', handleShowDetails);
        return () => window.removeEventListener('showEventDetails', handleShowDetails);
      }, []);

      useEffect(() => {
        const handleNavigate = (e) => {
          setView(e.detail);
        };
        window.addEventListener('navigateTo', handleNavigate);
        return () => window.removeEventListener('navigateTo', handleNavigate);
      }, []);

      const handleOnboardingComplete = () => {
        setShowOnboarding(false);
        loadPreferences(); // Recargar preferencias
      };

      if (showOnboarding) {
        return <OnboardingScreen onComplete={handleOnboardingComplete} />;
      }

  const renderView = () => {
        if (subView === 'subscriptions') {
          return <PageSubscriptions />;
        }
        if (subView === 'organize') {
          return <PageOrganize />;
        }
    switch (view) {
      case 'home':
        return <PageHome />;
      case 'swipe':
        return <PageSwipe />;
      case 'filters':
        return <PageFilters />;
      case 'map':
        return <PageMap />;
          case 'profile':
            return <PageProfile setSubView={setSubView} />;
      default:
        return <PageHome />;
    }
  };

  return (
    <div className="flex flex-col h-screen font-sans bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 mx-auto overflow-hidden app-container">
          {view === 'profile' && (
            <div className="flex items-center justify-between p-4 border-b border-gray-200 bg-white">
              <button
                onClick={() => {
                  setSubView(null);
                  if (subView) return;
                  setView('home');
                }}
                className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <ChevronLeft className="w-5 h-5" />
              </button>
              <div className="flex gap-2">
                <button
                  onClick={() => setSubView('organize')}
                  className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Organizar Evento
                </button>
                <button
                  onClick={() => setSubView('subscriptions')}
                  className="px-4 py-2 text-sm font-medium text-white bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-lg hover:from-yellow-500 hover:to-yellow-700 transition-all"
                >
                  Suscripciones
                </button>
              </div>
            </div>
          )}
      <main className="flex-grow overflow-hidden flex flex-col" style={{ minHeight: 0 }}>
        <div className="flex-1 overflow-y-auto custom-scrollbar">
        {renderView()}
        </div>
      </main>
      <NavBar view={view} setView={setView} />
      {selectedEvent && (
        <EventDetailsModal event={selectedEvent} onClose={() => setSelectedEvent(null)} />
      )}
    </div>
  );
}

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
